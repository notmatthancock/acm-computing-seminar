<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-08-30 Tue 21:59 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>ACM Computing Seminar Fortran Guide</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Joseph P. McKenna" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../css/main.css">
<link rel="stylesheet" type="text/css" href="../css/fortran.css">
<script src="../js/main.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">ACM Computing Seminar Fortran Guide</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline2">1. Introduction</a>
<ul>
<li><a href="#orgheadline1">1.1. About the language</a></li>
</ul>
</li>
<li><a href="#orgheadline9">2. Getting started</a>
<ul>
<li><a href="#orgheadline3">2.1. Text editor</a></li>
<li><a href="#orgheadline4">2.2. Compiler</a></li>
<li><a href="#orgheadline7">2.3. Writing and compiling a program</a>
<ul>
<li><a href="#orgheadline5">2.3.1. Hello world</a></li>
<li><a href="#orgheadline6">2.3.2. Template</a></li>
</ul>
</li>
<li><a href="#orgheadline8">2.4. Exercises</a></li>
</ul>
</li>
<li><a href="#orgheadline23">3. Data types</a>
<ul>
<li><a href="#orgheadline12">3.1. The <code>logical</code> type</a></li>
<li><a href="#orgheadline13">3.2. The <code>integer</code> type</a></li>
<li><a href="#orgheadline14">3.3. Floating point types</a></li>
<li><a href="#orgheadline15">3.4. The <code>character</code> type</a></li>
<li><a href="#orgheadline16">3.5. Casting</a></li>
<li><a href="#orgheadline17">3.6. The <code>parameter</code> keyword</a></li>
<li><a href="#orgheadline18">3.7. Setting the precision</a></li>
<li><a href="#orgheadline19">3.8. Pointers</a></li>
<li><a href="#orgheadline22">3.9. Arrays</a>
<ul>
<li><a href="#orgheadline20">3.9.1. Fixed-length arrays</a></li>
<li><a href="#orgheadline21">3.9.2. Dynamic length arrays</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline11">4. Control structures</a>
<ul>
<li><a href="#orgheadline27">4.1. Conditionals</a>
<ul>
<li><a href="#orgheadline24">4.1.1. The <code>if</code> construct</a></li>
<li><a href="#orgheadline25">4.1.2. Example: <code>if</code> / <code>else</code> and random number generation</a></li>
<li><a href="#orgheadline26">4.1.3. Example: <code>if</code> / <code>else if</code> / <code>else</code></a></li>
</ul>
</li>
<li><a href="#orgheadline34">4.2. Loops</a>
<ul>
<li><a href="#orgheadline29">4.2.1. The <code>do</code> loop</a>
<ul>
<li><a href="#orgheadline28">4.2.1.1. Example: row-major matrix</a></li>
</ul>
</li>
<li><a href="#orgheadline32">4.2.2. The <code>do while</code> loop</a>
<ul>
<li><a href="#orgheadline30">4.2.2.1. Example: truncated sum</a></li>
<li><a href="#orgheadline31">4.2.2.2. Example: estimating machine epsilon</a></li>
</ul>
</li>
<li><a href="#orgheadline33">4.2.3. Example: the <code>exit</code> keyword</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline40">5. Input/Output</a>
<ul>
<li><a href="#orgheadline37">5.1. File input/output</a>
<ul>
<li><a href="#orgheadline35">5.1.1. Reading data from file</a></li>
<li><a href="#orgheadline36">5.1.2. Writing data to file</a></li>
</ul>
</li>
<li><a href="#orgheadline38">5.2. Formatted input/output</a></li>
<li><a href="#orgheadline39">5.3. Command line arguments</a></li>
</ul>
</li>
<li><a href="#orgheadline52">6. Functions/Subroutines</a>
<ul>
<li><a href="#orgheadline42">6.1. Writing a function</a>
<ul>
<li><a href="#orgheadline41">6.1.1. Example: <code>linspace</code>: generating a set of equally-space points</a></li>
</ul>
</li>
<li><a href="#orgheadline44">6.2. Writing a subroutine</a>
<ul>
<li><a href="#orgheadline43">6.2.1. Example: polar coordinates</a></li>
</ul>
</li>
<li><a href="#orgheadline47">6.3. Passing procedures as arguments</a>
<ul>
<li><a href="#orgheadline45">6.3.1. Example: Newton's method for rootfinding</a></li>
<li><a href="#orgheadline46">6.3.2. Example: The midpoint rule for definite integrals</a></li>
</ul>
</li>
<li><a href="#orgheadline49">6.4. Polymorphism</a>
<ul>
<li><a href="#orgheadline48">6.4.1. Example: machine epsilon</a></li>
</ul>
</li>
<li><a href="#orgheadline51">6.5. Recursion</a>
<ul>
<li><a href="#orgheadline50">6.5.1. Example: factorial</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline56">7. Object-oriented programming</a>
<ul>
<li><a href="#orgheadline10">7.1. Derived types</a></li>
<li><a href="#orgheadline53">7.2. Modules</a></li>
<li><a href="#orgheadline54">7.3. Example: determinant of random matrix</a></li>
<li><a href="#orgheadline55">7.4. Example: matrix module</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="footer"><a href="../../../">ACM Computing Seminar Home</a> &mdash; This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.</div>
<a href="javascript:;" id="toc-open">&#9776;</a>
<a href="javascript:;" id="toc-close">&times;</a>

<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This guide is intended to quickly get you up-and-running in scientific computing with Fortran. 
</p>
</div>
<div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1"><span class="section-number-3">1.1</span> About the language</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Fortran was created in the 1950s for mathematical <b>FOR</b>-mula <b>TRAN</b>-slation, and has since gone through a number of revisions (FORTRAN 66, 77, and Fortran 90, 95, 2003, 2008, 2015). The language standards are put forth by the Fortran standards committee <a href="http://www.j3-fortran.org/">J3</a> in a document (ISO 1539-1:2010) available for purchase. The language syntax and intrinsic procedures make it especially suited for scientific computing. Fortran is a <b>statically-typed</b> and <b>compiled</b> language, like C++. You must declare the <b>type</b>, i.e. integer, real number, etc. of variables in programs you write. Your programs will be translated from human-readable <i>source code</i> into an executable file by software called a <b>compiler</b>. Fortran is <b>not case-sensitive</b>, so <code>matrix</code> and <code>MaTrIx</code> are translated to the same token by the compiler.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline9" class="outline-2">
<h2 id="orgheadline9"><span class="section-number-2">2</span> Getting started</h2>
<div class="outline-text-2" id="text-2">
<p>
The software that you need to get started comes prepackaged and ready to download on most Linux distributions. There are a few options for emulating a Linux environment in Windows or Mac OS, such as a virtual machine (VirtualBox) or package manager (MinGW or Cygwin on Windows and Brew on Mac OS).
</p>
</div>
<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3"><span class="section-number-3">2.1</span> Text editor</h3>
<div class="outline-text-3" id="text-2-1">
<p>
You will write the source code of your programs using a text editor. There are many options that have features designed for programming such as syntax highlighting and auto-completion. If you are an impossible-to-please perfectionist, you might want to check out <a href="https://www.gnu.org/s/emacs/">Emacs</a>. If you are easier to please, you might want to check out <a href="https://www.sublimetext.com/">Sublime Text</a>.
</p>
</div>
</div>
<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4"><span class="section-number-3">2.2</span> Compiler</h3>
<div class="outline-text-3" id="text-2-2">
<p>
To translate your source code into an executable, you will need a Fortran compiler. A free option is <b>gfortran</b>, part of the GNU compiler collection (gcc). The features of the Fortran language that are supported by the <code>gfortran</code> compiler are specified in the <a href="https://gcc.gnu.org/onlinedocs/gfortran/">compiler manual</a>. This is your most complete reference for the procedures intrinsic to Fortran that your programs can use. At the time of this writing, <code>gfortran</code> completely supports Fortran 95 and partially supports more recent standards.
</p>
</div>
</div>
<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">2.3</span> Writing and compiling a program</h3>
<div class="outline-text-3" id="text-2-3">
<p>
A program is delimited by the <code>begin program</code> / <code>end program</code> keywords. A useful construct for keeping code that a program can use is called a <b>module</b>. A module is delimited by the <code>begin module</code> / <code>end module</code> keywords.
</p>
</div>
<div id="outline-container-orgheadline5" class="outline-4">
<h4 id="orgheadline5"><span class="section-number-4">2.3.1</span> Hello world</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
Let's write a tiny program that prints "hello world" to the terminal screen in <code>hello.f90</code>.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr">1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr">2: </span>  <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'hello world'</span>
<span class="linenr">3: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<p>
To compile the program, execute the following command on the command line in the same directory as <code>hello.f90</code>
</p>

<div class="org-src-container">

<pre class="src src-sh">gfortran hello.f90
</pre>
</div>

<p>
This produces an executable file named <code>a.out</code> by default (On Windows, this is probably named <code>a.exe</code> by default). To run, execute the file.
</p>

<div class="org-src-container">

<pre class="src src-sh">./a.out
</pre>
</div>

<pre class="example">
hello world
</pre>

<p>
We could have specified a different name for the executable file during compilation with the <code>-o</code> option of <code>gfortran</code>.
</p>

<div class="org-src-container">

<pre class="src src-sh">gfortran hello.f90 -o my_executable_file
</pre>
</div>

<p>
On Windows, you should append the <code>.exe</code> extension to <code>my_executable_file</code>.
</p>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-4">
<h4 id="orgheadline6"><span class="section-number-4">2.3.2</span> Template</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
Now let's write an empty source code template for future projects. Our source code template will consist of two files in the same directory (<a href="./source/">./source/</a>). In the following files, the contents of a line after a <code>!</code> symbol is a comment that is ignored by the compiler. One file <code>header.f90</code> contains a module that defines things to be used in the main program.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr">1: </span><span style="color: #0000FF;">module</span> <span style="color: #006699;">header</span>
<span id="coderef-in1" class="coderef-off"><span class="linenr">2: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span></span>
<span class="linenr">3: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">variable declarations and assignments</span>
<span class="linenr">4: </span><span style="color: #0000FF;">contains</span>
<span class="linenr">5: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">function and subroutine definitions</span>
<span class="linenr">6: </span><span style="color: #0000FF;">end module</span> <span style="color: #006699;">header</span>
</pre>
</div>

<p>
This file should be compiled with the <code>-c</code> option of <code>gfortran</code>.
</p>

<div class="org-src-container">

<pre class="src src-sh">gfortran -c header.f90
</pre>
</div>

<p>
This outputs the <b>object file</b> named <code>header.o</code> by default. An object file contains machine code that can be <i>linked</i> to an executable. A separate file <code>main.f90</code> contains the main program.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr">1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span id="coderef-u" class="coderef-off"><span class="linenr">2: </span>  <span style="color: #0000FF;">use</span> <span style="color: #006699;">header</span></span>
<span id="coderef-in2" class="coderef-off"><span class="linenr">3: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span></span>
<span class="linenr">4: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">variable declarations and assignments</span>
<span class="linenr">5: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">function and subroutine calls</span>
<span class="linenr">6: </span><span style="color: #0000FF;">contains</span>
<span class="linenr">7: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">function and subroutine definitions</span>
<span class="linenr">8: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<p>
On line <a href="#coderef-u"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-u');" onmouseout="CodeHighlightOff(this, 'coderef-u');">2</a> of <code>main.f90</code>, we instruct the main program to use the contents of <code>header.f90</code>, so we must link <code>header.o</code> when compiling <code>main.f90</code>.
</p>

<div class="org-src-container">

<pre class="src src-sh">gfortran main.f90 header.o -o main
</pre>
</div>

<p>
To run the program, execute the output file <code>main</code>.
</p>

<div class="org-src-container">

<pre class="src src-sh">./main
</pre>
</div>

<p>
As you get more experience, you may find it cumbersome to repeatedly execute <code>gfortran</code> commands with every modification to your code. A way around this is to use the <code>make</code> command-line utility. Using <code>make</code>, all the of the compilation commands for your project can be coded in a file named <code>makefile</code> in the same directory as your <code>.f90</code> source files. For example, the template above could use the following <code>makefile</code>.
</p>

<div class="org-src-container">

<pre class="src src-make"><span class="linenr"> 1: </span><span style="color: #BA36A5;">COMPILER</span> = gfortran
<span class="linenr"> 2: </span><span style="color: #BA36A5;">SOURCE</span> = main.f90
<span class="linenr"> 3: </span><span style="color: #BA36A5;">EXECUTABLE</span> = main
<span id="coderef-obj" class="coderef-off"><span class="linenr"> 4: </span><span style="color: #BA36A5;">OBJECTS</span> = header.o</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #0000ff; font-weight: bold;">all</span>: $<span style="color: #707183;">(</span><span style="color: #BA36A5;">EXECUTABLE</span><span style="color: #707183;">)</span>
<span class="linenr"> 7: </span><span style="color: #0000ff; font-weight: bold;">$</span><span style="color: #707183; font-weight: bold;">(</span><span style="color: #0000ff; font-weight: bold;">EXECUTABLE</span><span style="color: #707183; font-weight: bold;">)</span>: $<span style="color: #707183;">(</span><span style="color: #BA36A5;">OBJECTS</span><span style="color: #707183;">)</span>
<span class="linenr"> 8: </span>  $<span style="color: #707183;">(</span><span style="color: #BA36A5;">COMPILER</span><span style="color: #707183;">)</span> $<span style="color: #707183;">(</span><span style="color: #BA36A5;">SOURCE</span><span style="color: #707183;">)</span> $<span style="color: #707183;">(</span><span style="color: #BA36A5;">OBJECTS</span><span style="color: #707183;">)</span> -o $<span style="color: #707183;">(</span><span style="color: #BA36A5;">EXECUTABLE</span><span style="color: #707183;">)</span>
<span class="linenr"> 9: </span><span style="color: #0000ff; font-weight: bold;">%.o</span>: %.f90
<span class="linenr">10: </span>  $<span style="color: #707183;">(</span><span style="color: #BA36A5;">COMPILER</span><span style="color: #707183;">)</span> -c $<span style="color: #D0372D;">&lt;</span>
</pre>
</div>

<p>
Then, to recompile both <code>header.f90</code> and <code>main.f90</code> after modifying either file, execute
</p>

<div class="org-src-container">

<pre class="src src-sh">make
</pre>
</div>

<p>
in the same directory as <code>makefile</code>. The first four lines of the <code>makefile</code> above define the compiler command, file name of the main program, file name of the executable to be created, and file name(s) of linked object file(s), respectively. If you wrote a second module in a separate file <code>my_second_header.f90</code> that you wanted to <code>use</code> in <code>main.f90</code>, you would modify line <a href="#coderef-obj"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-obj');" onmouseout="CodeHighlightOff(this, 'coderef-obj');">4</a> of <code>makefile</code> to <code>OBJ = header.o my_second_header.o</code>. The remaining lines of <code>makefile</code> define instructions for compilation.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8"><span class="section-number-3">2.4</span> Exercises</h3>
<div class="outline-text-3" id="text-2-4">
<ol class="org-ol">
<li>Compile and run <code>hello.f90</code>.</li>
<li>Execute <code>man gfortran</code> in any directory to bring up the manual for <code>gfortran</code>. Read the description and skim through the options. Do the same for <code>make</code>.</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-2">
<h2 id="orgheadline23"><span class="section-number-2">3</span> Data types</h2>
<div class="outline-text-2" id="text-3">
<p>
In both programs and modules, variables are declared first before other procedures. A variable is declared by listing its data type followed by <code>::</code> and the variable name, i.e. <code>integer :: i</code> or <code>real :: x</code>.
</p>

<p>
We will use the <code>implicit none</code> keyword at the beginning of each program and module as in line <a href="#coderef-in1"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-in1');" onmouseout="CodeHighlightOff(this, 'coderef-in1');">2</a> of <code>header.f90</code> and line <a href="#coderef-in2"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-in2');" onmouseout="CodeHighlightOff(this, 'coderef-in2');">3</a> of <code>main.f90</code> in Section <a href="#orgheadline6">2.3.2</a>. The role of this keyword is to suppress implicit rules for interpreting undeclared variables. By including it, we force ourselves to declare each variable we use, which should facilitate debugging when our program fails to compile. Without it, an undeclared variable with a name such as <code>i</code> is assumed to be of the <code>integer</code> data type whereas an undeclared variable with a name such as <code>x</code> is assumed to be of the <code>real</code> data type.
</p>

<p>
In addition to the most common data types presented below, Fortran has a <code>complex</code> data type and support for data types defined by the programmer (see Section <a href="#orgheadline10">7.1</a>).
</p>
</div>

<div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12"><span class="section-number-3">3.1</span> The <code>logical</code> type</h3>
<div class="outline-text-3" id="text-3-1">
<p>
A <code>logical</code> data type can have values <code>.true.</code> or <code>.false.</code>. Logical expressions can be expressed by combining unary or binary operations.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">logical</span> ::<span style="color: #BA36A5;"> a,b,c</span>
<span class="linenr"> 2: </span>a = <span style="color: #0000FF;">.true.</span>
<span class="linenr"> 3: </span>b = <span style="color: #0000FF;">.false.</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">'.not.' is the logical negation operator</span>
<span class="linenr"> 6: </span>c = <span style="color: #0000FF;">.not.</span>a <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is false</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">'.and,' is the logical and operator</span>
<span class="linenr"> 9: </span>c = a<span style="color: #0000FF;">.and.</span>b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is false</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">'.or.' is the logical or operator</span>
<span class="linenr">12: </span>c = a<span style="color: #0000FF;">.or.</span>b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is true</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">'==' is the test for equality</span>
<span class="linenr">15: </span>c = <span style="color: #D0372D;">1</span> == <span style="color: #D0372D;">2</span> <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is false</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">'/=' is test for inequality</span>
<span class="linenr">18: </span>c = <span style="color: #D0372D;">1</span> /= <span style="color: #D0372D;">2</span> <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is true</span>
<span class="linenr">19: </span><span style="color: #0000FF;">print</span>*, c
</pre>
</div>

<p>
Other logical operators include
</p>
<ul class="org-ul">
<li><code>&lt;</code> or <code>.lt.</code>: less than</li>
<li><code>&lt;=</code> or <code>.le.</code>: less than or equal</li>
<li><code>&gt;</code> or <code>.gt.</code>: greater than</li>
<li><code>&gt;=</code> or <code>.ge.</code>: greater than or equal</li>
</ul>

<p>
Logical expressions are often used in <a href="#orgheadline11">control structures</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13"><span class="section-number-3">3.2</span> The <code>integer</code> type</h3>
<div class="outline-text-3" id="text-3-2">
<p>
An <code>integer</code> data type can have integer values. If a real value is assigned to an <code>integer</code> type, the decimal portion is chopped off.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> a = 6, b = 7 </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">initialize a and b to 6 and 7, resp</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> c</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>c = a + b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is 13</span>
<span class="linenr"> 5: </span>c = a - b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is -1</span>
<span class="linenr"> 6: </span>c = a / b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is 0</span>
<span class="linenr"> 7: </span>c = b / a <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is 1</span>
<span class="linenr"> 8: </span>c = a*b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is 42</span>
<span class="linenr"> 9: </span>c = a**b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is 6^7</span>
<span class="linenr">10: </span>c = <span style="color: #0000FF;">mod</span><span style="color: #707183;">(</span>b,a<span style="color: #707183;">)</span> <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is (b mod a) = 1</span>
<span class="linenr">11: </span>c = a &gt; b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is 0 (logical gets cast to integer)</span>
<span class="linenr">12: </span>c = a &lt; b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is 1 (logical gets cast to integer)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14"><span class="section-number-3">3.3</span> Floating point types</h3>
<div class="outline-text-3" id="text-3-3">
<p>
The two floating point data types <code>real</code> and <code>double precision</code> correspond to <a href="https://en.wikipedia.org/wiki/IEEE_floating_point">IEEE 32- and 64-bit floating point data types</a>. A constant called <i>machine epsilon</i> is the least positive number in a floating point system that when added to 1 results in a floating point number larger than 1. It is common in numerical analysis error estimates.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> a </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare a single precision float</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">double precision</span> ::<span style="color: #BA36A5;"> b </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare a double precision float</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">Print the min/max value and machine epsilon</span>
<span class="linenr"> 5: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">for the single precision floating point system</span>
<span class="linenr"> 6: </span><span style="color: #0000FF;">print</span>*, <span style="color: #0000FF;">tiny</span><span style="color: #707183;">(</span>a<span style="color: #707183;">)</span>, <span style="color: #0000FF;">huge</span><span style="color: #707183;">(</span>a<span style="color: #707183;">)</span>, <span style="color: #0000FF;">epsilon</span><span style="color: #707183;">(</span>a<span style="color: #707183;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">Print the min/max value and machine epsilon</span>
<span class="linenr"> 9: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">for the double precision floating point system</span>
<span class="linenr">10: </span><span style="color: #0000FF;">print</span>*, <span style="color: #0000FF;">tiny</span><span style="color: #707183;">(</span>b<span style="color: #707183;">)</span>, <span style="color: #0000FF;">huge</span><span style="color: #707183;">(</span>b<span style="color: #707183;">)</span>, <span style="color: #0000FF;">epsilon</span><span style="color: #707183;">(</span>b<span style="color: #707183;">)</span>
</pre>
</div>

<pre class="example">
1.17549435E-38   3.40282347E+38   1.19209290E-07
2.2250738585072014E-308   1.7976931348623157E+308   2.2204460492503131E-016
</pre>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">3.4</span> The <code>character</code> type</h3>
<div class="outline-text-3" id="text-3-4">
<p>
A <code>character</code> data type can have character values, i.e. letters or symbols. A character string is declared with a positive <code>integer</code> specifying its maximum possible length.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr">1: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare a character variable s at most 32 characters</span>
<span class="linenr">2: </span><span style="color: #6434A3;">character</span><span style="color: #707183;">(</span><span style="color: #D0372D;">32</span><span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> s</span>
<span class="linenr">3: </span>
<span class="linenr">4: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">assign value to s</span>
<span class="linenr">5: </span>s = <span style="color: #008000;">'file_name'</span>
<span class="linenr">6: </span>
<span class="linenr">7: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">trim trailing spaces from s and</span>
<span class="linenr">8: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">append a character literal '.txt'</span>
<span class="linenr">9: </span><span style="color: #0000FF;">print</span>*, <span style="color: #0000FF;">trim</span><span style="color: #707183;">(</span>s<span style="color: #707183;">)</span> // <span style="color: #008000;">'.txt'</span>
</pre>
</div>

<pre class="example">
file_name.txt
</pre>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16"><span class="section-number-3">3.5</span> Casting</h3>
<div class="outline-text-3" id="text-3-5">
<p>
An <code>integer</code> can be cast to a <code>real</code> and vice versa.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> a = 1, b</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> c, PI = 3.14159</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">explicit cast real to integer</span>
<span class="linenr"> 5: </span>b = <span style="color: #0000FF;">int</span><span style="color: #707183;">(</span>PI<span style="color: #707183;">)</span> <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">b is 3</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">explicit cast integer to real then divide</span>
<span class="linenr"> 8: </span>c = a/<span style="color: #0000FF;">real</span><span style="color: #707183;">(</span>b<span style="color: #707183;">)</span> <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is .3333...</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">divide then implicit cast real to integer</span>
<span class="linenr">11: </span>c = a/b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">c is 0</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17"><span class="section-number-3">3.6</span> The <code>parameter</code> keyword</h3>
<div class="outline-text-3" id="text-3-6">
<p>
The <code>parameter</code> keyword is used to declare constants. A constant must be assigned a value at declaration and cannot be reassigned a value. The following code is not valid because of an attempt to reassign a constant.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr">1: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare constant variable</span>
<span class="linenr">2: </span><span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">parameter</span> ::<span style="color: #BA36A5;"> PI = 2.*asin</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">1.</span><span style="color: #707183;">)</span><span style="color: #BA36A5;"> </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">'asin' is arcsine</span>
<span class="linenr">3: </span>
<span class="linenr">4: </span>PI = <span style="color: #D0372D;">3</span> <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">not valid</span>
</pre>
</div>

<p>
The compiler produces an error like <code>Error: Named constant ‘pi’ in variable definition context (assignment)</code>.
</p>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-3">
<h3 id="orgheadline18"><span class="section-number-3">3.7</span> Setting the precision</h3>
<div class="outline-text-3" id="text-3-7">
<p>
The <code>kind</code> function returns an <code>integer</code> for each data type. The precision of a floating point number can be specified at declaration by a literal or constant <code>integer</code> of the desired <code>kind</code>.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare a single precision</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> r </span>
<span class="linenr"> 3: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare a double precision</span>
<span class="linenr"> 4: </span><span style="color: #6434A3;">double precision</span> ::<span style="color: #BA36A5;"> d</span>
<span class="linenr"> 5: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">store single precision and double precision kinds</span>
<span class="linenr"> 6: </span><span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">parameter</span> ::<span style="color: #BA36A5;"> sp = kind</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">r</span><span style="color: #707183;">)</span><span style="color: #BA36A5;">, dp = kind</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">d</span><span style="color: #707183;">)</span>
<span class="linenr"> 7: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">set current kind</span>
<span id="coderef-rp" class="coderef-off"><span class="linenr"> 8: </span><span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">parameter</span> ::<span style="color: #BA36A5;"> rp = sp</span></span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare real b in double precision</span>
<span class="linenr">11: </span><span style="color: #6434A3;">real</span><span style="color: #707183;">(</span>dp<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> b</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare real a with precision kind rp</span>
<span class="linenr">14: </span><span style="color: #6434A3;">real</span><span style="color: #707183;">(</span>rp<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> a</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">cast 1 to real with precision kind rp and assign to a</span>
<span class="linenr">17: </span>a = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0_rp</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">cast b to real with precision kind rp and assign to a</span>
<span class="linenr">20: </span>a = <span style="color: #0000FF;">real</span><span style="color: #707183;">(</span>b,rp<span style="color: #707183;">)</span>
</pre>
</div>

<p>
To switch the precision of each variable above with kind <code>rp</code>, we would only need to modify the declaration of <code>rp</code> on line <a href="#coderef-rp"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-rp');" onmouseout="CodeHighlightOff(this, 'coderef-rp');">8</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19"><span class="section-number-3">3.8</span> Pointers</h3>
<div class="outline-text-3" id="text-3-8">
<p>
Pointers have the same meaning in Fortran as in C++. A pointer is a variable that holds the <b>memory address</b> of a variable. The implementation of pointers is qualitatively different in Fortran than in C++. In Fortran, the user cannot view the memory address that a pointer stores. A pointer variable is declared with the <code>pointer</code> modifier, and a variable that it points to is declared with the <code>target</code> modifier. The types of a <code>pointer</code> and its <code>target</code> must match.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare pointer</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">pointer</span> ::<span style="color: #BA36A5;"> p</span>
<span class="linenr"> 3: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare targets</span>
<span class="linenr"> 4: </span><span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">target</span> ::<span style="color: #BA36A5;"> a = 1, b = 2</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>p =&gt; a <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">p has same memory address as a</span>
<span class="linenr"> 7: </span>p = <span style="color: #D0372D;">2</span> <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">modify value at address</span>
<span class="linenr"> 8: </span><span style="color: #0000FF;">print</span>*, a==<span style="color: #D0372D;">2</span> <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">a is 2</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>p =&gt; b <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">p has same memory address as b</span>
<span class="linenr">11: </span>p = <span style="color: #D0372D;">1</span> <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">modify value at address</span>
<span class="linenr">12: </span><span style="color: #0000FF;">print</span>*, b==<span style="color: #D0372D;">1</span> <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">b is 1</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">is p associated with a target?</span>
<span class="linenr">15: </span><span style="color: #0000FF;">print</span>*, <span style="color: #0000FF;">associated</span><span style="color: #707183;">(</span>p<span style="color: #707183;">)</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">is p associated with the target a?</span>
<span class="linenr">18: </span><span style="color: #0000FF;">print</span>*, <span style="color: #0000FF;">associated</span><span style="color: #707183;">(</span>p, a<span style="color: #707183;">)</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">point to nowhere</span>
<span class="linenr">21: </span><span style="color: #0000FF;">nullify</span><span style="color: #707183;">(</span>p<span style="color: #707183;">)</span>
</pre>
</div>

<pre class="example">
T
T
T
F
</pre>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22"><span class="section-number-3">3.9</span> Arrays</h3>
<div class="outline-text-3" id="text-3-9">
<p>
The length of an array can be fixed or dynamic. The index of an array starts at 1 by default, but any index range can be specified.
</p>
</div>
<div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20"><span class="section-number-4">3.9.1</span> Fixed-length arrays</h4>
<div class="outline-text-4" id="text-3-9-1">
<p>
An array can be declared with a single <code>integer</code> specifying its length in which cast the first index of the array is 1. An array can also be declared with an <code>integer</code> range specifying its first and last index.
</p>

<p>
Here's a one-dimensional array example.
</p>
<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare arrray of length 5</span>
<span class="linenr"> 2: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">index range is 1 to 5 (inclusive)</span>
<span class="linenr"> 3: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> a</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">5</span><span style="color: #707183;">)</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">you can work with each component individually</span>
<span class="linenr"> 6: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">set the first component to 1</span>
<span class="linenr"> 7: </span>a<span style="color: #707183;">(</span><span style="color: #D0372D;">1</span><span style="color: #707183;">)</span> = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">or you can work with the whole array</span>
<span class="linenr">10: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">set the whole array to 2</span>
<span class="linenr">11: </span>a = <span style="color: #D0372D;">2</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">or you can with slices of the array</span>
<span class="linenr">14: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">set elements 2 to 4 (inclusive) to 3</span>
<span class="linenr">15: </span>a<span style="color: #707183;">(</span><span style="color: #D0372D;">2</span>:<span style="color: #D0372D;">4</span><span style="color: #707183;">)</span> = <span style="color: #D0372D;">3</span>.<span style="color: #D0372D;">0</span>
</pre>
</div>

<p>
And, here's a two-dimensional array example.
</p>
<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare 5x5 array</span>
<span class="linenr"> 2: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">index range is 1 to 5 (inclusive) in both axes</span>
<span class="linenr"> 3: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> a</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">5,5</span><span style="color: #707183;">)</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">you can work with each component individually</span>
<span class="linenr"> 6: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">set upper left component to 1</span>
<span class="linenr"> 7: </span>a<span style="color: #707183;">(</span><span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span> = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">or you can work with the whole array</span>
<span class="linenr">10: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">set the whole array to 2</span>
<span class="linenr">11: </span>a = <span style="color: #D0372D;">2</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">or you can with slices of the array</span>
<span class="linenr">14: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">set a submatrix to 3</span>
<span class="linenr">15: </span>a<span style="color: #707183;">(</span><span style="color: #D0372D;">2</span>:<span style="color: #D0372D;">4</span>, <span style="color: #D0372D;">1</span>:<span style="color: #D0372D;">2</span><span style="color: #707183;">)</span> = <span style="color: #D0372D;">3</span>.<span style="color: #D0372D;">0</span>
</pre>
</div>

<p>
Fortran includes intrinsic functions to operate on an array <code>a</code> such as
</p>
<ul class="org-ul">
<li><code>size(a)</code>: number of elements of <code>a</code></li>
<li><code>minval(a)</code>: minimum value of <code>a</code></li>
<li><code>maxval(a)</code>: maximum value of <code>a</code></li>
<li><code>sum(a)</code>: sum of elements in <code>a</code></li>
<li><code>product(a)</code>: product of elements in <code>a</code></li>
</ul>
<p>
See the <code>gfortran</code> documentation for more.
</p>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-4">
<h4 id="orgheadline21"><span class="section-number-4">3.9.2</span> Dynamic length arrays</h4>
<div class="outline-text-4" id="text-3-9-2">
<p>
Dynamic arrays are declared with the <code>allocatable</code> modifier. Before storing values in such an array, you must <code>allocate</code> memory for the array. After you are finished the array, you ought to <code>deallocate</code> the memory that it occupies.
</p>

<p>
Here's a one-dimensional array example.
</p>
<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare a one-dim. dynamic length array</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">allocatable</span> ::<span style="color: #BA36A5;"> a</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">:</span><span style="color: #707183;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">allocate memory for a</span>
<span class="linenr"> 5: </span><span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>a<span style="color: #7388D6;">(</span><span style="color: #D0372D;">5</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">now you can treat a like a normal array</span>
<span class="linenr"> 8: </span>a<span style="color: #707183;">(</span><span style="color: #D0372D;">1</span><span style="color: #707183;">)</span> = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>
<span class="linenr"> 9: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">etc...</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">deallocate memory occupied by a</span>
<span class="linenr">12: </span><span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>a<span style="color: #707183;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">we can change the size and index range of a</span>
<span class="linenr">15: </span><span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>a<span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span>:<span style="color: #D0372D;">10</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span>a<span style="color: #707183;">(</span><span style="color: #D0372D;">0</span><span style="color: #707183;">)</span> = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">18: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">etc...</span>
<span class="linenr">19: </span>
<span id="coderef-d" class="coderef-off"><span class="linenr">20: </span><span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>a<span style="color: #707183;">)</span></span>
</pre>
</div>

<p>
Without the last <code>dellaocate</code> statement on line <a href="#coderef-d"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-d');" onmouseout="CodeHighlightOff(this, 'coderef-d');">20</a> the code above is valid, but the memory that is allocated for <code>a</code> will not be freed. That memory then cannot be allocated to other resources.
</p>

<p>
Here's a two-dimensional array example.
</p>
<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare a two-dim. dynamic length array</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">allocatable</span> ::<span style="color: #BA36A5;"> a</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">:,:</span><span style="color: #707183;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">allocate memory for a</span>
<span class="linenr"> 5: </span><span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>a<span style="color: #7388D6;">(</span><span style="color: #D0372D;">5</span>,<span style="color: #D0372D;">5</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">now you can treat a like a normal array</span>
<span class="linenr"> 8: </span>a<span style="color: #707183;">(</span><span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span> = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>
<span class="linenr"> 9: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">etc...</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">deallocate memory occupied by a</span>
<span class="linenr">12: </span><span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>a<span style="color: #707183;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">we can change the size and index range of a</span>
<span class="linenr">15: </span><span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>a<span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span>:<span style="color: #D0372D;">10</span>,<span style="color: #D0372D;">0</span>:<span style="color: #D0372D;">10</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span>a<span style="color: #707183;">(</span><span style="color: #D0372D;">0</span>,<span style="color: #D0372D;">0</span><span style="color: #707183;">)</span> = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">18: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">etc...</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>a<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-2">
<h2 id="orgheadline11"><span class="section-number-2">4</span> Control structures</h2>
<div class="outline-text-2" id="text-4">
<p>
Control structures are used to direct the flow of code execution.
</p>
</div>
<div id="outline-container-orgheadline27" class="outline-3">
<h3 id="orgheadline27"><span class="section-number-3">4.1</span> Conditionals</h3>
<div class="outline-text-3" id="text-4-1">
</div><div id="outline-container-orgheadline24" class="outline-4">
<h4 id="orgheadline24"><span class="section-number-4">4.1.1</span> The <code>if</code> construct</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
The <code>if</code> construct controls execution of a single block of code. If the block of code is more than one line, it should be delimited by an <code>if</code> / <code>end if</code> pair. If the block of code is one line, it can be written on one line. A common typo is to forget the <code>then</code> keyword following the logical in an <code>if</code> / <code>end if</code> pair.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr">1: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> num = 0.75</span>
<span class="linenr">2: </span>
<span class="linenr">3: </span><span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>num &lt; .<span style="color: #D0372D;">5</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">4: </span>   <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num: '</span>, num
<span class="linenr">5: </span>   <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num is less than 0.5'</span>
<span class="linenr">6: </span><span style="color: #0000FF;">end if</span>
<span class="linenr">7: </span>
<span class="linenr">8: </span><span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>num &gt; .<span style="color: #D0372D;">5</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num is greater than 0.5'</span>
</pre>
</div>

<pre class="example">
num is greater than 0.5
</pre>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-4">
<h4 id="orgheadline25"><span class="section-number-4">4.1.2</span> Example: <code>if</code> / <code>else</code> and random number generation</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
The <code>if</code> / <code>else</code> construct controls with mutually exclusive logic the execution of two blocks of code.
</p>

<p>
The following code generates a random number between 0 and 1, then prints the number and whether or not the number is greater than 0.5
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> num</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">seed random number generator</span>
<span class="linenr"> 4: </span><span style="color: #0000FF;">call</span> <span style="color: #006699;">srand</span><span style="color: #707183;">(</span><span style="color: #D0372D;">789</span><span style="color: #707183;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">rand() returns a random number between 0 and 1</span>
<span class="linenr"> 7: </span>num = rand<span style="color: #707183;">()</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num: '</span>, num
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>num &lt; <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">5</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">12: </span>   <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num is less than 0.5'</span>
<span class="linenr">13: </span><span style="color: #0000FF;">else</span>
<span class="linenr">14: </span>   <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num is greater then 0.5'</span>
<span class="linenr">15: </span><span style="color: #0000FF;">end if</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">do it again</span>
<span class="linenr">18: </span>num = rand<span style="color: #707183;">()</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num: '</span>, num
<span class="linenr">21: </span>
<span class="linenr">22: </span><span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>num &lt; <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">5</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">23: </span>   <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num is less than 0.5'</span>
<span class="linenr">24: </span><span style="color: #0000FF;">else</span>
<span class="linenr">25: </span>   <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num is greater then 0.5'</span>
<span class="linenr">26: </span><span style="color: #0000FF;">end if</span>
</pre>
</div>

<pre class="example">
num:    6.17480278E-03
num is less than 0.5
num:   0.783314705    
num is greater then 0.5
</pre>

<p>
Since the random number generator was seeded with a literal integer, the above code will produce the <i>same</i> output each time it is run.
</p>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-4">
<h4 id="orgheadline26"><span class="section-number-4">4.1.3</span> Example: <code>if</code> / <code>else if</code> / <code>else</code></h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
The <code>if</code> / <code>else if</code> / <code>else</code> construct controls with mutually exclusive logic the execution of three or more blocks of code. The following code generates a random number between 0 and 1, then prints the number and which quarter of the interval \([0,1]\) that the number is in.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> num</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">seed random number generator with current time</span>
<span class="linenr"> 4: </span><span style="color: #0000FF;">call</span> <span style="color: #006699;">srand</span><span style="color: #707183;">(</span>time<span style="color: #7388D6;">()</span><span style="color: #707183;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">rand() returns a random number between 0 and 1</span>
<span class="linenr"> 7: </span>num = rand<span style="color: #707183;">()</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num:'</span>, num
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>num &gt; <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">75</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">12: </span>   <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num is between 0.75 and 1'</span>
<span class="linenr">13: </span><span style="color: #0000FF;">else if</span> <span style="color: #707183;">(</span>num &gt; <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">5</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">14: </span>   <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num is between 0.5 and 0.75'</span>
<span class="linenr">15: </span><span style="color: #0000FF;">else if</span> <span style="color: #707183;">(</span>num &gt; <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">25</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">16: </span>   <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num is between 0.25 and 0.5'</span>
<span class="linenr">17: </span><span style="color: #0000FF;">else</span>
<span class="linenr">18: </span>   <span style="color: #0000FF;">print</span>*, <span style="color: #008000;">'num is between 0 and 0.25'</span>
<span class="linenr">19: </span><span style="color: #0000FF;">end if</span>
</pre>
</div>

<pre class="example">
num:  0.179898977    
num is between 0 and 0.25
</pre>

<p>
Since the random number generator was seeded with the current time, the above code will produce a <i>different</i> output each time it is run.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline34" class="outline-3">
<h3 id="orgheadline34"><span class="section-number-3">4.2</span> Loops</h3>
<div class="outline-text-3" id="text-4-2">
</div><div id="outline-container-orgheadline29" class="outline-4">
<h4 id="orgheadline29"><span class="section-number-4">4.2.1</span> The <code>do</code> loop</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
A <code>do</code> loop iterates a block of code over a range of integers. It takes two <code>integer</code> arguments specifying the minimum and maximum (inclusive) of the range and takes an optional third <code>integer</code> argument specifying the iteration stride in the form <code>do i=min,max,stride</code>. If omitted, the stride is 1.
</p>

<p>
The following code assigns a value to each component of an array then prints it.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> max = 10, i</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">allocatable</span> ::<span style="color: #BA36A5;"> x</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">:</span><span style="color: #707183;">)</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>x<span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span>:max<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #0000FF;">do</span> i = <span style="color: #D0372D;">0</span>,max
<span class="linenr"> 7: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">assign to each array component</span>
<span class="linenr"> 8: </span>   x<span style="color: #707183;">(</span>i<span style="color: #707183;">)</span> = i / <span style="color: #0000FF;">real</span><span style="color: #707183;">(</span>max<span style="color: #707183;">)</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print current component</span>
<span class="linenr">11: </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">"('x(', i0, ') = ', f3.1)"</span>, i, x<span style="color: #707183;">(</span>i<span style="color: #707183;">)</span>
<span class="linenr">12: </span><span style="color: #0000FF;">end do</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span>
</pre>
</div>

<pre class="example">
x(0) = 0.0
x(1) = 0.1
x(2) = 0.2
x(3) = 0.3
x(4) = 0.4
x(5) = 0.5
x(6) = 0.6
x(7) = 0.7
x(8) = 0.8
x(9) = 0.9
x(10) = 1.0
</pre>

<p>
An <i>implicit</i> <code>do loop</code> can be used for formulaic array assignments. The following code creates the same array as the last example.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr">1: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> max = 10</span>
<span class="linenr">2: </span><span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">allocatable</span> ::<span style="color: #BA36A5;"> x</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">:</span><span style="color: #707183;">)</span>
<span class="linenr">3: </span>
<span class="linenr">4: </span><span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>x<span style="color: #7388D6;">(</span><span style="color: #D0372D;">0</span>:max<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">5: </span>
<span class="linenr">6: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">implicit do loop for formulaic array assignment</span>
<span class="linenr">7: </span>x = <span style="color: #707183;">[</span><span style="color: #7388D6;">(</span>i / <span style="color: #0000FF;">real</span><span style="color: #909183;">(</span>max<span style="color: #909183;">)</span>, i=<span style="color: #D0372D;">0</span>, max<span style="color: #7388D6;">)</span><span style="color: #707183;">]</span>
<span class="linenr">8: </span>
<span class="linenr">9: </span><span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span>
</pre>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-5">
<h5 id="orgheadline28"><span class="section-number-5">4.2.1.1</span> Example: row-major matrix</h5>
<div class="outline-text-5" id="text-4-2-1-1">
<p>
The following code stores matrix data in a one-dimensional array named <code>matrix</code> in <code>row-major</code> order. This means the first <code>n_cols</code> elements of the array will contain the first row of the matrix, the next <code>n_cols</code> of the array will contain the second row of the matrix, etc.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> n_rows = 4, n_cols = 3</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">allocatable</span> ::<span style="color: #BA36A5;"> matrix</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">:</span><span style="color: #707183;">)</span>
<span class="linenr"> 3: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">temporary indices</span>
<span class="linenr"> 4: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> i,j,k</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">index range is 1 to 12 (inclusive)</span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>matrix<span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span>:n_rows*n_cols<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">assign 0 to all elements of matrix</span>
<span class="linenr">10: </span>matrix = <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #0000FF;">do</span> i = <span style="color: #D0372D;">1</span>,n_rows
<span class="linenr">13: </span>   <span style="color: #0000FF;">do</span> j = <span style="color: #D0372D;">1</span>,n_cols
<span class="linenr">14: </span>      <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">convert (i,j) matrix index to "flat" row-major index</span>
<span class="linenr">15: </span>      k = <span style="color: #707183;">(</span>i-<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>*n_cols + j
<span class="linenr">16: </span>
<span class="linenr">17: </span>      <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">assign 1 to diagonal, 2 to sub/super-diagonal</span>
<span class="linenr">18: </span>      <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>i==j<span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">19: </span>         matrix<span style="color: #707183;">(</span>k<span style="color: #707183;">)</span> = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">20: </span>      <span style="color: #0000FF;">else if</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>i==j-<span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span><span style="color: #0000FF;">.or.</span><span style="color: #7388D6;">(</span>i==j+<span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">21: </span>         matrix<span style="color: #707183;">(</span>k<span style="color: #707183;">)</span> = <span style="color: #D0372D;">2</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">22: </span>      <span style="color: #0000FF;">end if</span>
<span class="linenr">23: </span>   <span style="color: #0000FF;">end do</span>
<span class="linenr">24: </span><span style="color: #0000FF;">end do</span>
<span class="linenr">25: </span>
<span class="linenr">26: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print matrix row by row</span>
<span class="linenr">27: </span><span style="color: #0000FF;">do</span> i = <span style="color: #D0372D;">1</span>,n_rows
<span class="linenr">28: </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">"(3(f5.1))"</span>, matrix<span style="color: #707183;">(</span><span style="color: #D0372D;">1</span>+<span style="color: #7388D6;">(</span>i-<span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span>*n_cols:i*n_cols<span style="color: #707183;">)</span>
<span class="linenr">29: </span><span style="color: #0000FF;">end do</span>
<span class="linenr">30: </span>
<span class="linenr">31: </span><span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>matrix<span style="color: #707183;">)</span>
</pre>
</div>

<pre class="example">
1.0  2.0  0.0
2.0  1.0  2.0
0.0  2.0  1.0
0.0  0.0  2.0
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline32" class="outline-4">
<h4 id="orgheadline32"><span class="section-number-4">4.2.2</span> The <code>do while</code> loop</h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
A <code>do while</code> loop iterates while a logical condition evaluates to <code>.true.</code>.
</p>
</div>
<div id="outline-container-orgheadline30" class="outline-5">
<h5 id="orgheadline30"><span class="section-number-5">4.2.2.1</span> Example: truncated sum</h5>
<div class="outline-text-5" id="text-4-2-2-1">
<p>
The following code approximates the geometric series
</p>
\begin{equation*}
\sum_{n=1}^{\infty}\left(\frac12\right)^n=1.
\end{equation*}
<p>
The <code>do while</code> loop begins with \(n=1\) and exits when the current summand does not increase the current sum. It prints the iteration number, current sum, and absolute error
</p>
\begin{equation*}
E=1-\sum_{n=1}^{\infty}\left(\frac12\right)^n.
\end{equation*}

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> sum = 0.0, base = 0.5, tol = 1e-4</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> pow = 0.5</span>
<span class="linenr"> 3: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> iter = 1</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #0000FF;">do while</span> <span style="color: #707183;">(</span>sum+pow &gt; sum<span style="color: #707183;">)</span>
<span class="linenr"> 6: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">add pow to sum</span>
<span class="linenr"> 7: </span>   sum = sum+pow
<span class="linenr"> 8: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">update pow by one power of base</span>
<span class="linenr"> 9: </span>   pow = pow*base
<span class="linenr">10: </span>
<span class="linenr">11: </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">"('Iter: ', i3, ', Sum: ', f0.10, ', Abs Err: ', f0.10)"</span>, iter, sum, <span style="color: #D0372D;">1</span>-sum
<span class="linenr">12: </span>   
<span class="linenr">13: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">update iter by 1</span>
<span class="linenr">14: </span>   iter = iter+<span style="color: #D0372D;">1</span>
<span class="linenr">15: </span><span style="color: #0000FF;">end do</span>
</pre>
</div>

<pre class="example">
Iter:   1, Sum: .5000000000, Abs Err: .5000000000
Iter:   2, Sum: .7500000000, Abs Err: .2500000000
Iter:   3, Sum: .8750000000, Abs Err: .1250000000
Iter:   4, Sum: .9375000000, Abs Err: .0625000000
Iter:   5, Sum: .9687500000, Abs Err: .0312500000
Iter:   6, Sum: .9843750000, Abs Err: .0156250000
Iter:   7, Sum: .9921875000, Abs Err: .0078125000
Iter:   8, Sum: .9960937500, Abs Err: .0039062500
Iter:   9, Sum: .9980468750, Abs Err: .0019531250
Iter:  10, Sum: .9990234375, Abs Err: .0009765625
Iter:  11, Sum: .9995117188, Abs Err: .0004882812
Iter:  12, Sum: .9997558594, Abs Err: .0002441406
Iter:  13, Sum: .9998779297, Abs Err: .0001220703
Iter:  14, Sum: .9999389648, Abs Err: .0000610352
Iter:  15, Sum: .9999694824, Abs Err: .0000305176
Iter:  16, Sum: .9999847412, Abs Err: .0000152588
Iter:  17, Sum: .9999923706, Abs Err: .0000076294
Iter:  18, Sum: .9999961853, Abs Err: .0000038147
Iter:  19, Sum: .9999980927, Abs Err: .0000019073
Iter:  20, Sum: .9999990463, Abs Err: .0000009537
Iter:  21, Sum: .9999995232, Abs Err: .0000004768
Iter:  22, Sum: .9999997616, Abs Err: .0000002384
Iter:  23, Sum: .9999998808, Abs Err: .0000001192
Iter:  24, Sum: .9999999404, Abs Err: .0000000596
Iter:  25, Sum: 1.0000000000, Abs Err: .0000000000
</pre>
</div>
</div>

<div id="outline-container-orgheadline31" class="outline-5">
<h5 id="orgheadline31"><span class="section-number-5">4.2.2.2</span> Example: estimating machine epsilon</h5>
<div class="outline-text-5" id="text-4-2-2-2">
<p>
The following code finds machine epsilon by shifting the rightmost bit of a binary number rightward until it falls off. Think about how it does this. Could you write an algorithm that finds machine epsilon using the function <code>rshift</code> that shifts the bits of float rightward?
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">double precision</span> ::<span style="color: #BA36A5;"> eps</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">parameter</span> ::<span style="color: #BA36A5;"> dp = kind</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">eps</span><span style="color: #707183;">)</span>
<span class="linenr"> 3: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> count = 1</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>eps = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0_dp</span>
<span class="linenr"> 6: </span><span style="color: #0000FF;">do while</span> <span style="color: #707183;">(</span><span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0_dp</span> + eps*<span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">5</span> &gt; <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0_dp</span><span style="color: #707183;">)</span>
<span class="linenr"> 7: </span>   eps = eps*<span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">5</span>
<span class="linenr"> 8: </span>   count = count+<span style="color: #D0372D;">1</span>
<span class="linenr"> 9: </span><span style="color: #0000FF;">end do</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #0000FF;">print</span>*, eps, <span style="color: #0000FF;">epsilon</span><span style="color: #707183;">(</span>eps<span style="color: #707183;">)</span>
<span class="linenr">12: </span><span style="color: #0000FF;">print</span>*, count, <span style="color: #0000FF;">digits</span><span style="color: #707183;">(</span>eps<span style="color: #707183;">)</span>
</pre>
</div>

<pre class="example">
2.2204460492503131E-016   2.2204460492503131E-016
       53          53
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline33" class="outline-4">
<h4 id="orgheadline33"><span class="section-number-4">4.2.3</span> Example: the <code>exit</code> keyword</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
The <code>exit</code> keyword stops execution of code within the current scope.
</p>

<p>
The following code finds the <i>hailstone sequence</i> of \(a_1=6\) defined recursively by
</p>
\begin{equation*}
a_{n+1} =
\begin{cases}
a_n/2 & \text{if } a_n \text{ is even}\\
3a_n+1 & \text{ if } a_n \text{ is odd} 
\end{cases}
\end{equation*}
<p>
for \(n\geq1\). It is an open conjecture that the hailstone sequence of any initial value \(a_1\) converges to the periodic sequence \(4, 2, 1, 4, 2, 1\ldots\). Luckily, it does for \(a_1=6\) and the following infinite <code>do</code> loop exits.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> a = 6, count = 1</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">infinite loop</span>
<span class="linenr"> 4: </span><span style="color: #0000FF;">do</span>
<span class="linenr"> 5: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">if a is even, divide by 2</span>
<span class="linenr"> 6: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">otherwise multiply by 3 and add 1</span>
<span class="linenr"> 7: </span>   <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span><span style="color: #0000FF;">mod</span><span style="color: #7388D6;">(</span>a,<span style="color: #D0372D;">2</span><span style="color: #7388D6;">)</span>==<span style="color: #D0372D;">0</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr"> 8: </span>      a = a/<span style="color: #D0372D;">2</span>
<span class="linenr"> 9: </span>   <span style="color: #0000FF;">else</span>
<span class="linenr">10: </span>      a = <span style="color: #D0372D;">3</span>*a+<span style="color: #D0372D;">1</span>
<span class="linenr">11: </span>   <span style="color: #0000FF;">end if</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">if a is 4, exit infinite loop</span>
<span class="linenr">14: </span>   <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>a==<span style="color: #D0372D;">4</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">15: </span>      <span style="color: #0000FF;">exit</span>
<span class="linenr">16: </span>   <span style="color: #0000FF;">end if</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print count and a</span>
<span class="linenr">19: </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">"('count: ', i2, ', a: ', i2)"</span>, count, a
<span class="linenr">20: </span>
<span class="linenr">21: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">increment count</span>
<span class="linenr">22: </span>   count = count + <span style="color: #D0372D;">1</span>
<span class="linenr">23: </span><span style="color: #0000FF;">end do</span>
</pre>
</div>

<pre class="example">
count:  1, a:  3
count:  2, a: 10
count:  3, a:  5
count:  4, a: 16
count:  5, a:  8
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline40" class="outline-2">
<h2 id="orgheadline40"><span class="section-number-2">5</span> Input/Output</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-orgheadline37" class="outline-3">
<h3 id="orgheadline37"><span class="section-number-3">5.1</span> File input/output</h3>
<div class="outline-text-3" id="text-5-1">
</div><div id="outline-container-orgheadline35" class="outline-4">
<h4 id="orgheadline35"><span class="section-number-4">5.1.1</span> Reading data from file</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
The contents of a data file can be read into an array using <code>read</code>. Suppose you have a file <code>./data/array.txt</code> that contains two columns of data
</p>

<pre class="example">
1 1.23
2 2.34
3 3.45
4 4.56
5 5.67
</pre>

<p>
This file can be opened with the <code>open</code> command. The required first argument of <code>open</code> is an <code>integer</code> that specifies a <i>file unit</i> for <code>array.txt</code>. Choose any number that is not in use. The unit numbers <code>0</code>, <code>5</code>, and <code>6</code> are reserved for system files and should not be used accidentally. Data are read in <b>row-major</b> format, i.e. across the first row, then across the second row, etc.
</p>

<p>
The following code reads the contents of <code>./data/array.txt</code> into an array called <code>array</code>.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare array</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> array</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">5,2</span><span style="color: #707183;">)</span>
<span class="linenr"> 3: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> row</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">open file and assign file unit 10</span>
<span class="linenr"> 6: </span><span style="color: #0000FF;">open</span> <span style="color: #707183;">(</span><span style="color: #D0372D;">10</span>, file=<span style="color: #008000;">'./data/array.txt'</span>, action=<span style="color: #008000;">'read'</span><span style="color: #707183;">)</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">read data from file unit 10 into array</span>
<span class="linenr"> 9: </span><span style="color: #0000FF;">do</span> row = <span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">5</span>
<span class="linenr">10: </span>   <span style="color: #0000FF;">read</span><span style="color: #707183;">(</span><span style="color: #D0372D;">10</span>,*<span style="color: #707183;">)</span> array<span style="color: #707183;">(</span>row,:<span style="color: #707183;">)</span>
<span class="linenr">11: </span><span style="color: #0000FF;">end do</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">close file</span>
<span class="linenr">14: </span><span style="color: #0000FF;">close</span><span style="color: #707183;">(</span><span style="color: #D0372D;">10</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline36" class="outline-4">
<h4 id="orgheadline36"><span class="section-number-4">5.1.2</span> Writing data to file</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
Data can be written to a file with the <code>write</code> command.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> x</span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> i, max = 5</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">open file, specify unit 10, overwrite if exists</span>
<span class="linenr"> 5: </span><span style="color: #0000FF;">open</span><span style="color: #707183;">(</span><span style="color: #D0372D;">10</span>, file=<span style="color: #008000;">'./data/sine.txt'</span>, action=<span style="color: #008000;">'write'</span>, status=<span style="color: #008000;">'replace'</span><span style="color: #707183;">)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">do</span> i = <span style="color: #D0372D;">0</span>,max
<span class="linenr"> 8: </span>   x = i / <span style="color: #0000FF;">real</span><span style="color: #707183;">(</span>max<span style="color: #707183;">)</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>   <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">write to file unit 10</span>
<span class="linenr">11: </span>   <span style="color: #0000FF;">write</span><span style="color: #707183;">(</span><span style="color: #D0372D;">10</span>,*<span style="color: #707183;">)</span> x, <span style="color: #0000FF;">sin</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span>
<span class="linenr">12: </span><span style="color: #0000FF;">end do</span>
</pre>
</div>

<p>
This produces a file <code>sine.txt</code> in the directory <code>data</code> containing
</p>

<pre class="example">
 0.00000000       0.00000000    
0.200000003      0.198669329    
0.400000006      0.389418334    
0.600000024      0.564642489    
0.800000012      0.717356086    
 1.00000000      0.841470957    
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline38" class="outline-3">
<h3 id="orgheadline38"><span class="section-number-3">5.2</span> Formatted input/output</h3>
<div class="outline-text-3" id="text-5-2">
<p>
The format of a <code>print</code>, <code>write</code>, or <code>read</code> statement can be specified with a <code>character</code> string. A format character string replaces the <code>*</code> symbol in <code>print*</code> and the second <code>*</code> symbol in <code>read(*,*)</code> or <code>write(*,*)</code>. A format string is a list of literal character strings or character descriptors from
</p>
<ul class="org-ul">
<li><code>a</code>: character string</li>
<li><code>iW</code>: integer</li>
<li><code>fW.D</code>: float point</li>
<li><code>esW.DeE</code>: scientific notation</li>
<li><code>Wx</code>: space</li>
</ul>
<p>
where <code>W</code>, <code>D</code>, and <code>E</code> should be replaced by numbers specifying width, number of digits, or number  of exponent digits, resp. The width of a formatted integer or float defaults to the width of the number when <code>W</code> is <code>0</code>.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #6434A3;">character</span><span style="color: #707183;">(</span><span style="color: #D0372D;">32</span><span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> fmt, a = 'word' </span>
<span class="linenr"> 2: </span><span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> b = 1</span>
<span class="linenr"> 3: </span><span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> c = 2.0, d = 3.0</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">character string and 4 space-delimited values</span>
<span class="linenr"> 6: </span><span style="color: #0000FF;">print</span> <span style="color: #008000;">"('four values: ', a, 1x i0, 1x f0.1, 1x, es6.1e1)"</span>, <span style="color: #0000FF;">trim</span><span style="color: #707183;">(</span>a<span style="color: #707183;">)</span>, b, c, d
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">character string and 2 space-delimited values</span>
<span class="linenr"> 9: </span>fmt = <span style="color: #008000;">'(a, 2(f0.1, 1x))'</span>
<span class="linenr">10: </span><span style="color: #0000FF;">print</span> fmt, <span style="color: #008000;">'two values: '</span>, c, d
</pre>
</div>

<pre class="example">
four values: word 1 2.0 3.0E+0
two values: 2.0 3.0
</pre>
</div>
</div>

<div id="outline-container-orgheadline39" class="outline-3">
<h3 id="orgheadline39"><span class="section-number-3">5.3</span> Command line arguments</h3>
<div class="outline-text-3" id="text-5-3">
<p>
Arguments can be passed to a program from the command line using <code>get_command_argument</code>. The first argument received by <code>get_command_argument</code> is the program executable file name and the remaining arguments are passed by the user. The following program accepts any number of arguments, each at most 32 characters, and prints them.
</p>

<div class="org-src-container">

<pre class="src src-fortran" id="orgsrcblock1"><span class="linenr"> 1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr"> 2: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>  <span style="color: #6434A3;">character</span><span style="color: #707183;">(</span><span style="color: #D0372D;">32</span><span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> arg</span>
<span class="linenr"> 5: </span>  <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> n_arg = 0</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>  <span style="color: #0000FF;">do</span>
<span class="linenr"> 8: </span>     <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">get next command line argument</span>
<span class="linenr"> 9: </span>     <span style="color: #0000FF;">call</span> <span style="color: #006699;">get_command_argument</span><span style="color: #707183;">(</span>n_arg, arg<span style="color: #707183;">)</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span>     <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">if it is empty, exit</span>
<span class="linenr">12: </span>     <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span><span style="color: #0000FF;">len_trim</span><span style="color: #7388D6;">(</span>arg<span style="color: #7388D6;">)</span> == <span style="color: #D0372D;">0</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">exit</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span>     <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print argument to screen</span>
<span class="linenr">15: </span>     <span style="color: #0000FF;">print</span><span style="color: #008000;">"('argument ', i0, ': ', a)"</span>, n_arg, <span style="color: #0000FF;">trim</span><span style="color: #707183;">(</span>arg<span style="color: #707183;">)</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span>     <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">increment count</span>
<span class="linenr">18: </span>     n_arg = n_arg+<span style="color: #D0372D;">1</span>
<span class="linenr">19: </span>  <span style="color: #0000FF;">end do</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print total number of arguments</span>
<span class="linenr">22: </span>  <span style="color: #0000FF;">print</span> <span style="color: #008000;">"('number of arguments: ', i0)"</span>, n_arg
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<p>
After compiling to <code>a.out</code>, you can pass arguments in the executing command.
</p>

<div class="org-src-container">

<pre class="src src-sh">./a.out <span style="color: #D0372D;">1</span> <span style="color: #D0372D;">2</span> <span style="color: #D0372D;">34</span>
</pre>
</div>

<pre class="example">
argument 0: ./a.out
argument 1: 1
argument 2: 2
argument 3: 34
number of arguments: 4
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline52" class="outline-2">
<h2 id="orgheadline52"><span class="section-number-2">6</span> Functions/Subroutines</h2>
<div class="outline-text-2" id="text-6">
<p>
Functions and subroutines are callable blocks of code. A <code>function</code> returns a value from a set of arguments. A <code>subroutine</code> executes a block of code from a set of arguments but does not explicitly return a value. Changes to arguments made within a <code>function</code> are not returned whereas changes to arguments made within a <code>subroutine</code> can be returned to the calling program. Both functions and subroutines are defined after the <code>contains</code> keyword in a <code>module</code> or <code>program</code>.
</p>
</div>
<div id="outline-container-orgheadline42" class="outline-3">
<h3 id="orgheadline42"><span class="section-number-3">6.1</span> Writing a function</h3>
<div class="outline-text-3" id="text-6-1">
<p>
The definition of a function starts with the name of the function followed by a list of arguments and return variable. The data types of the arguments and return variable are defined within the <code>function</code> body.
</p>
</div>
<div id="outline-container-orgheadline41" class="outline-4">
<h4 id="orgheadline41"><span class="section-number-4">6.1.1</span> Example: <code>linspace</code>: generating a set of equally-space points</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
The following program defines a function <code>linspace</code> that returns a set of equidistant points on an interval. The main function makes a call to the function.
</p>
<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr"> 2: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>  <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> xs</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">10</span><span style="color: #707183;">)</span>
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">call function linspace to set values in xs</span>
<span class="linenr"> 7: </span>  xs = linspace<span style="color: #707183;">(</span><span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0</span>, <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>, <span style="color: #D0372D;">10</span><span style="color: #707183;">)</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print returned value of xs</span>
<span class="linenr">10: </span>  <span style="color: #0000FF;">print</span> <span style="color: #008000;">"(10(f0.1, 1x))"</span> , xs
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #0000FF;">contains</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">linspace: return a set of equidistant points on an interval</span>
<span class="linenr">15: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">min: minimum value of interval</span>
<span class="linenr">16: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">max: maximum value of interval</span>
<span class="linenr">17: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">n_points: number of points in returned set</span>
<span class="linenr">18: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">xs: set of points</span>
<span class="linenr">19: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">linspace</span><span style="color: #707183;">(</span>min, max, n_points<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>xs<span style="color: #707183;">)</span>
<span class="linenr">20: </span>    <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> min, max, dx</span>
<span class="linenr">21: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> n_points</span>
<span class="linenr">22: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> i</span>
<span class="linenr">23: </span>    <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> xs</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">n_points</span><span style="color: #707183;">)</span>
<span class="linenr">24: </span>
<span class="linenr">25: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">calculate width of subintervals</span>
<span class="linenr">26: </span>    dx = <span style="color: #707183;">(</span>max-min<span style="color: #707183;">)</span> / <span style="color: #0000FF;">real</span><span style="color: #707183;">(</span>n_points-<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr">27: </span>
<span class="linenr">28: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">fill xs with points</span>
<span class="linenr">29: </span>    <span style="color: #0000FF;">do</span> i = <span style="color: #D0372D;">1</span>,n_points
<span class="linenr">30: </span>       xs<span style="color: #707183;">(</span>i<span style="color: #707183;">)</span> = min + <span style="color: #707183;">(</span>i-<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>*dx
<span class="linenr">31: </span>    <span style="color: #0000FF;">end do</span>
<span class="linenr">32: </span>
<span class="linenr">33: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">linspace</span>
<span class="linenr">34: </span>
<span class="linenr">35: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<pre class="example">
.0 .1 .2 .3 .4 .6 .7 .8 .9 1.0
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline44" class="outline-3">
<h3 id="orgheadline44"><span class="section-number-3">6.2</span> Writing a subroutine</h3>
<div class="outline-text-3" id="text-6-2">
<p>
The definition of a subroutine begins with the name of the subroutine and list of arguments. Arguments are defined within the <code>subroutine</code> body with one of the following intents
</p>
<ul class="org-ul">
<li><code>intent(in)</code>: changes to the argument are not returned</li>
<li><code>intent(inout)</code>: changes to the argument are returned</li>
<li><code>intent(out)</code>: the initial value of the argument is ignored and changes to the argument are returned.</li>
</ul>
<p>
Subroutines are called using the <code>call</code> keyword followed by the subroutine name.
</p>
</div>

<div id="outline-container-orgheadline43" class="outline-4">
<h4 id="orgheadline43"><span class="section-number-4">6.2.1</span> Example: polar coordinates</h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
The following code defines a subroutine <code>polar_coord</code> that returns the polar coordinates \((r,\theta)\) defined by \(r=\sqrt{x^2+y^2}\) and \(\theta=\arctan(y/x)\) from the rectangular coordinate pair \((x,y)\).
</p>
<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span>  <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> x = 1.0, y = 1.0, rad, theta</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">call subroutine that returns polar coords</span>
<span class="linenr"> 6: </span>  <span style="color: #0000FF;">call</span> <span style="color: #006699;">polar_coord</span><span style="color: #707183;">(</span>x, y, rad, theta<span style="color: #707183;">)</span>
<span class="linenr"> 7: </span>  <span style="color: #0000FF;">print</span>*, rad, theta
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #0000FF;">contains</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">polar_coord: return the polar coordinates of a rect coord pair</span>
<span class="linenr">12: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">x,y: rectangular coord</span>
<span class="linenr">13: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">rad,theta: polar coord</span>
<span class="linenr">14: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">polar_coord</span><span style="color: #707183;">(</span>x, y, rad, theta<span style="color: #707183;">)</span>
<span class="linenr">15: </span>    <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> x, y</span>
<span class="linenr">16: </span>    <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>out<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> rad, theta</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">compute polar coord</span>
<span class="linenr">19: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">hypot = sqrt(x**2+y**2) is an intrinsic function</span>
<span class="linenr">20: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">atan2 = arctan with correct sign is an intrinsic function</span>
<span class="linenr">21: </span>    rad = <span style="color: #0000FF;">hypot</span><span style="color: #707183;">(</span>x, y<span style="color: #707183;">)</span>
<span class="linenr">22: </span>    theta = <span style="color: #0000FF;">atan2</span><span style="color: #707183;">(</span>y, x<span style="color: #707183;">)</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span>    <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">polar_coord</span>
<span class="linenr">25: </span>
<span class="linenr">26: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<pre class="example">
1.41421354      0.785398185
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline47" class="outline-3">
<h3 id="orgheadline47"><span class="section-number-3">6.3</span> Passing procedures as arguments</h3>
<div class="outline-text-3" id="text-6-3">
<p>
An <code>inteface</code> can be used to pass a function or subroutine to another function or a subroutine. For this purpose, an <code>interface</code> is defined in the receiving procedure essentially the same way as the passed procedure itself but with only declarations and not the implementation.
</p>
</div>
<div id="outline-container-orgheadline45" class="outline-4">
<h4 id="orgheadline45"><span class="section-number-4">6.3.1</span> Example: Newton's method for rootfinding</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
Newton's method for finding the root of a function \(f:\mathbb{R}\rightarrow\mathbb{R}\) refines an initial guess \(x_0\) according to the iteration rule
</p>
\begin{equation*}
x_{n+1}=x_n-\frac{f(x_n)}{f'(x_n)}
\end{equation*}
<p>
for \(n\geq1\) until \(f(x)\) is less than a chosen tolerance or a maximum number of iterations.
</p>

<p>
The following code defines a subroutine <code>newton_root</code> that returns a root of an input function as well as the number of iterations of Newton's method used to find the root. It is called by the  main program to approximate the positive root of \(f(x)=x^2-2\) from an initial guess \(x_0=1\).
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr"> 2: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>  <span style="color: #6434A3;">character</span><span style="color: #707183;">(</span><span style="color: #D0372D;">64</span><span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> fmt</span>
<span class="linenr"> 5: </span>  <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> x = 1.0</span>
<span class="linenr"> 6: </span>  <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> iter = 1000</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">call newton rootfinding function</span>
<span class="linenr"> 9: </span>  <span style="color: #0000FF;">call</span> <span style="color: #006699;">newton_root</span><span style="color: #707183;">(</span>f, df, x, iter, <span style="color: #D0372D;">1e</span>-<span style="color: #D0372D;">6</span>, <span style="color: #0000FF;">.true.</span><span style="color: #707183;">)</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print found root and number of iterations used</span>
<span class="linenr">12: </span>  fmt = <span style="color: #008000;">"('number of iterations: ', i0, ', x: ', f0.7, ', f(x): ', f0.7)"</span>
<span class="linenr">13: </span>  <span style="color: #0000FF;">print</span> fmt, iter, x, f<span style="color: #707183;">(</span>x<span style="color: #707183;">)</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #0000FF;">contains</span>
<span class="linenr">16: </span>
<span class="linenr">17: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">function f(x) = x^2 - 2</span>
<span class="linenr">18: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">f</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>y<span style="color: #707183;">)</span>
<span class="linenr">19: </span>    <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> x, y</span>
<span class="linenr">20: </span>    y = x*x - <span style="color: #D0372D;">2</span>
<span class="linenr">21: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">f</span>
<span class="linenr">22: </span>
<span class="linenr">23: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">function df(x) = 2x</span>
<span class="linenr">24: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">df</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>dy<span style="color: #707183;">)</span>
<span class="linenr">25: </span>    <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> x, dy</span>
<span class="linenr">26: </span>    dy = <span style="color: #D0372D;">2</span>*x
<span class="linenr">27: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">df</span>
<span class="linenr">28: </span>
<span class="linenr">29: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">newton_root: newtons method for rootfinding</span>
<span class="linenr">30: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">f: function with root</span>
<span class="linenr">31: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">df: derivative of f</span>
<span class="linenr">32: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">x: sequence iterate</span>
<span class="linenr">33: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">iter: max number of iterations at call, number of iterations at return</span>
<span class="linenr">34: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">tol: absolute tolerance</span>
<span class="linenr">35: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print_iters: boolean to toggle verbosity</span>
<span class="linenr">36: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">newton_root</span><span style="color: #707183;">(</span>f, df, x, iter, tol, print_iters<span style="color: #707183;">)</span>
<span class="linenr">37: </span>
<span class="linenr">38: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">interface to function f</span>
<span class="linenr">39: </span>    <span style="color: #0000FF;">interface</span>
<span class="linenr">40: </span>       <span style="color: #0000FF;">function</span> <span style="color: #006699;">f</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>y<span style="color: #707183;">)</span>
<span class="linenr">41: </span>         <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> x, y</span>
<span class="linenr">42: </span>       <span style="color: #0000FF;">end function</span> <span style="color: #006699;">f</span>
<span class="linenr">43: </span>    <span style="color: #0000FF;">end interface</span>
<span class="linenr">44: </span>
<span class="linenr">45: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">interface to function df</span>
<span class="linenr">46: </span>    <span style="color: #0000FF;">interface</span>
<span class="linenr">47: </span>       <span style="color: #0000FF;">function</span> <span style="color: #006699;">df</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>dy<span style="color: #707183;">)</span>
<span class="linenr">48: </span>         <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> x, dy</span>
<span class="linenr">49: </span>       <span style="color: #0000FF;">end function</span> <span style="color: #006699;">df</span>
<span class="linenr">50: </span>    <span style="color: #0000FF;">end interface</span>
<span class="linenr">51: </span>
<span class="linenr">52: </span>    <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>inout<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> x</span>
<span class="linenr">53: </span>    <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> tol</span>
<span class="linenr">54: </span>    <span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>inout<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> iter</span>
<span class="linenr">55: </span>    <span style="color: #6434A3;">logical</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> print_iters</span>
<span class="linenr">56: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> max_iters</span>
<span class="linenr">57: </span>
<span class="linenr">58: </span>    max_iters = iter
<span class="linenr">59: </span>    iter = <span style="color: #D0372D;">0</span>
<span class="linenr">60: </span>
<span class="linenr">61: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">while f(x) greater than absolute tolerance</span>
<span class="linenr">62: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">and max number of iterations not exceeded</span>
<span class="linenr">63: </span>    <span style="color: #0000FF;">do while</span> <span style="color: #707183;">(</span><span style="color: #0000FF;">abs</span><span style="color: #7388D6;">(</span>f<span style="color: #909183;">(</span>x<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>&gt;tol<span style="color: #0000FF;">.and.</span>iter&lt;max_iters<span style="color: #707183;">)</span>
<span class="linenr">64: </span>       <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print current x and f(x)</span>
<span class="linenr">65: </span>       <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>print_iters<span style="color: #707183;">)</span> <span style="color: #0000FF;">print</span> <span style="color: #008000;">"('f(', f0.7, ') = ', f0.7)"</span>, x, f<span style="color: #707183;">(</span>x<span style="color: #707183;">)</span>
<span class="linenr">66: </span>
<span class="linenr">67: </span>       <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">Newton's update rule</span>
<span class="linenr">68: </span>       x = x - f<span style="color: #707183;">(</span>x<span style="color: #707183;">)</span>/df<span style="color: #707183;">(</span>x<span style="color: #707183;">)</span>
<span class="linenr">69: </span>
<span class="linenr">70: </span>       <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">increment number of iterations</span>
<span class="linenr">71: </span>       iter = iter + <span style="color: #D0372D;">1</span>
<span class="linenr">72: </span>    <span style="color: #0000FF;">end do</span>
<span class="linenr">73: </span>
<span class="linenr">74: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">newton_root</span>
<span class="linenr">75: </span>
<span class="linenr">76: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<pre class="example">
f(1.0000000) = -1.0000000
f(1.5000000) = .2500000
f(1.4166666) = .0069444
f(1.4142157) = .0000060
number of iterations: 4, x: 1.4142135, f(x): -.0000001
</pre>
</div>
</div>

<div id="outline-container-orgheadline46" class="outline-4">
<h4 id="orgheadline46"><span class="section-number-4">6.3.2</span> Example: The midpoint rule for definite integrals</h4>
<div class="outline-text-4" id="text-6-3-2">
<p>
The midpoint rule approximates the definite integral \(\int_a^bf(x)~dx\) with integrand \(f:\mathbb{R}\rightarrow\mathbb{R}\) by
</p>
\begin{equation}
\Delta x\sum_{i=1}^nf(\bar{x}_i)
\end{equation}
<p>
where \(\Delta x=(b-a)/n\), \(x_i=a+i\Delta x\) and \(\bar{x}_i=(x_{i-1}+x_i)/2\).
</p>

<p>
The following code defines a function <code>midpoint</code> that computes the approximation eq. <a href="#orglatexenvironment1">1</a> given \(a\), \(b\), and \(n\). The main program calls <code>midpoint</code> to approximate the definite integral of \(f(x)=1/x\) on \([1,e]\) for a range of \(n\).
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr"> 2: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>  <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">parameter</span> ::<span style="color: #BA36A5;"> E = exp</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">1.</span><span style="color: #707183;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> n</span>
<span class="linenr"> 6: </span>  <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> integral</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">Approximate the integral of 1/x from 1 to e</span>
<span class="linenr"> 9: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">with the midpoint rule for a range of number of subintervals</span>
<span class="linenr">10: </span>  <span style="color: #0000FF;">do</span> n = <span style="color: #D0372D;">2</span>,<span style="color: #D0372D;">20</span>,<span style="color: #D0372D;">2</span>
<span class="linenr">11: </span>     <span style="color: #0000FF;">print</span> <span style="color: #008000;">"('n: ', i0, ', M_n: ', f0.6)"</span>, n, midpoint<span style="color: #707183;">(</span>f, <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>, E, n<span style="color: #707183;">)</span>
<span class="linenr">12: </span>  <span style="color: #0000FF;">end do</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #0000FF;">contains</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">function f(x) = 1/x</span>
<span class="linenr">17: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">f</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>y<span style="color: #707183;">)</span>
<span class="linenr">18: </span>    <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> x, y</span>
<span class="linenr">19: </span>    y = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>/x
<span class="linenr">20: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">f</span>
<span class="linenr">21: </span>
<span class="linenr">22: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">midpoint: midpoint rule for definite integral</span>
<span class="linenr">23: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">f: integrand</span>
<span class="linenr">24: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">a: left endpoint of interval of integration</span>
<span class="linenr">25: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">b: right endpoint of interval of integration</span>
<span class="linenr">26: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">n: number of subintervals</span>
<span class="linenr">27: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">sum: approximate definite integral</span>
<span class="linenr">28: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">midpoint</span><span style="color: #707183;">(</span>f, a, b, n<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>sum<span style="color: #707183;">)</span>
<span class="linenr">29: </span>
<span class="linenr">30: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">interface to f</span>
<span class="linenr">31: </span>    <span style="color: #0000FF;">interface</span>
<span class="linenr">32: </span>       <span style="color: #0000FF;">function</span> <span style="color: #006699;">f</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span>
<span class="linenr">33: </span>         <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> x, y</span>
<span class="linenr">34: </span>       <span style="color: #0000FF;">end function</span> <span style="color: #006699;">f</span>
<span class="linenr">35: </span>    <span style="color: #0000FF;">end interface</span>
<span class="linenr">36: </span>
<span class="linenr">37: </span>    <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> a, b, min, xi, dx, sum</span>
<span class="linenr">38: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> n, i</span>
<span class="linenr">39: </span>
<span class="linenr">40: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">subinterval increment</span>
<span class="linenr">41: </span>    dx = <span style="color: #707183;">(</span>b-a<span style="color: #707183;">)</span>/<span style="color: #0000FF;">real</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>
<span class="linenr">42: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">minimum to increment from</span>
<span class="linenr">43: </span>    min = a - dx/<span style="color: #D0372D;">2</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">44: </span>
<span class="linenr">45: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">midpoint rule</span>
<span class="linenr">46: </span>    <span style="color: #0000FF;">do</span> i = <span style="color: #D0372D;">1</span>,n
<span class="linenr">47: </span>       xi = min + i*dx
<span class="linenr">48: </span>       sum = sum + f<span style="color: #707183;">(</span>xi<span style="color: #707183;">)</span>
<span class="linenr">49: </span>    <span style="color: #0000FF;">end do</span>
<span class="linenr">50: </span>    sum = sum*dx
<span class="linenr">51: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">midpoint</span>
<span class="linenr">52: </span>
<span class="linenr">53: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<pre class="example">
n: 2, M_n: .976360
n: 4, M_n: .993575
n: 6, M_n: .997091
n: 8, M_n: .998353
n: 10, M_n: .998942
n: 12, M_n: .999264
n: 14, M_n: .999459
n: 16, M_n: .999585
n: 18, M_n: .999672
n: 20, M_n: .999735
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-3">
<h3 id="orgheadline49"><span class="section-number-3">6.4</span> Polymorphism</h3>
<div class="outline-text-3" id="text-6-4">
<p>
An <code>interface</code> can be used as an entry into two different implementations of a subroutine or function with the same name so long as the different implementations have different argument signatures. This may be particularly useful for defining both a single precision and double precision version of a function or subroutine.
</p>
</div>
<div id="outline-container-orgheadline48" class="outline-4">
<h4 id="orgheadline48"><span class="section-number-4">6.4.1</span> Example: machine epsilon</h4>
<div class="outline-text-4" id="text-6-4-1">
<p>
The following code implements two versions of a function that computes machine epsilon in either single or double precision. The different implementations are distinguished by their arguments. The single precision version <code>mach_eps_sp</code> accepts one single precision float and the double precision version <code>mach_eps_dp</code> accepts one double precision float. Both functions are listed in the <code>interface</code> and can be called by its name <code>mach_eps</code>.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr"> 2: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>  <span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">parameter</span> ::<span style="color: #BA36A5;"> sp = kind</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">0.0</span><span style="color: #707183;">)</span>
<span class="linenr"> 5: </span>  <span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">parameter</span> ::<span style="color: #BA36A5;"> dp = kind</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">0.d0</span><span style="color: #707183;">)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>  <span style="color: #0000FF;">interface</span> <span style="color: #006699;">mach_eps</span>
<span class="linenr"> 8: </span>     <span style="color: #6434A3;">procedure</span><span style="color: #BA36A5;"> mach_eps_sp, mach_eps_dp</span>
<span class="linenr"> 9: </span>  <span style="color: #0000FF;">end interface</span> <span style="color: #006699;">mach_eps</span>
<span class="linenr">10: </span>
<span class="linenr">11: </span>  <span style="color: #0000FF;">print</span>*, mach_eps<span style="color: #707183;">(</span><span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0_sp</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">epsilon</span><span style="color: #707183;">(</span><span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0_sp</span><span style="color: #707183;">)</span>
<span class="linenr">12: </span>  <span style="color: #0000FF;">print</span>*, mach_eps<span style="color: #707183;">(</span><span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0_dp</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">epsilon</span><span style="color: #707183;">(</span><span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0_dp</span><span style="color: #707183;">)</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #0000FF;">contains</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">mach_eps_sp</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>eps<span style="color: #707183;">)</span>
<span class="linenr">17: </span>    <span style="color: #6434A3;">real</span><span style="color: #707183;">(</span>sp<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> x, eps</span>
<span class="linenr">18: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> count = 0</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span>    eps = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0_sp</span>
<span class="linenr">21: </span>    <span style="color: #0000FF;">do while</span> <span style="color: #707183;">(</span><span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0_sp</span> + eps*<span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">5</span> &gt; <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0_sp</span><span style="color: #707183;">)</span>
<span class="linenr">22: </span>       eps = eps*<span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">5</span>
<span class="linenr">23: </span>       count = count+<span style="color: #D0372D;">1</span>
<span class="linenr">24: </span>    <span style="color: #0000FF;">end do</span>
<span class="linenr">25: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">mach_eps_sp</span>
<span class="linenr">26: </span>
<span class="linenr">27: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">mach_eps_dp</span><span style="color: #707183;">(</span>x<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>eps<span style="color: #707183;">)</span>
<span class="linenr">28: </span>    <span style="color: #6434A3;">real</span><span style="color: #707183;">(</span>dp<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> x, eps</span>
<span class="linenr">29: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> count = 0</span>
<span class="linenr">30: </span>
<span class="linenr">31: </span>    eps = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0_dp</span>
<span class="linenr">32: </span>    <span style="color: #0000FF;">do while</span> <span style="color: #707183;">(</span><span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0_dp</span> + eps*<span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">5</span> &gt; <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0_dp</span><span style="color: #707183;">)</span>
<span class="linenr">33: </span>       eps = eps*<span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">5</span>
<span class="linenr">34: </span>       count = count+<span style="color: #D0372D;">1</span>
<span class="linenr">35: </span>    <span style="color: #0000FF;">end do</span>
<span class="linenr">36: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">mach_eps_dp</span>
<span class="linenr">37: </span>
<span class="linenr">38: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<pre class="example">
1.19209290E-07   1.19209290E-07
2.2204460492503131E-016   2.2204460492503131E-016
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline51" class="outline-3">
<h3 id="orgheadline51"><span class="section-number-3">6.5</span> Recursion</h3>
<div class="outline-text-3" id="text-6-5">
<p>
A function or subroutine that calls itself must be defined with the <code>recursive</code> keyword preceding the construct name.
</p>
</div>
<div id="outline-container-orgheadline50" class="outline-4">
<h4 id="orgheadline50"><span class="section-number-4">6.5.1</span> Example: factorial</h4>
<div class="outline-text-4" id="text-6-5-1">
<p>
The following code defines a recursive function <code>factorial</code> that computes \(n!\). If \(n>1\), the function call itself to return \(n(n-1)!\), otherwise the function returns \(1\). The main program calls <code>factorial</code> to compute \(5!\).
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr"> 2: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print 5 factorial</span>
<span class="linenr"> 5: </span>  <span style="color: #0000FF;">print</span>*, factorial<span style="color: #707183;">(</span><span style="color: #D0372D;">5</span><span style="color: #707183;">)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">contains</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">factorial(n): product of natural numbers up to n</span>
<span class="linenr">10: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">n: integer argument</span>
<span class="linenr">11: </span>  <span style="color: #0000FF;">recursive</span> <span style="color: #0000FF;">function</span> <span style="color: #006699;">factorial</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>m<span style="color: #707183;">)</span>
<span class="linenr">12: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> n, m</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">if n&gt;1, call factorial recursively</span>
<span class="linenr">15: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">otherwise 1 factorial is 1</span>
<span class="linenr">16: </span>    <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>n&gt;1<span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">17: </span>       m = n*factorial<span style="color: #707183;">(</span>n-<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr">18: </span>    <span style="color: #0000FF;">else</span>
<span class="linenr">19: </span>       m = <span style="color: #D0372D;">1</span>
<span class="linenr">20: </span>    <span style="color: #0000FF;">end if</span>
<span class="linenr">21: </span>
<span class="linenr">22: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">factorial</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<pre class="example">
120
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline56" class="outline-2">
<h2 id="orgheadline56"><span class="section-number-2">7</span> Object-oriented programming</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10"><span class="section-number-3">7.1</span> Derived types</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Data types can be defined by the programmer. Variables and procedures that belong to a defined data type are declared between a <code>type</code> / <code>end type</code> pair. Type-bound procedures, i.e. functions and subroutines, are defined by the <code>procedure</code> keyword followed by <code>::</code> and the name of the procedure within the <code>type</code> / <code>end type</code> pair after the <code>contains</code> keyword. A variable with defined type is declared with the <code>type</code> keyword and the name of the type. The variables and procedures of a defined type variable can be accessed by appending a <code>%</code> symbol to the name of the variable.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">define a 'matrix' type</span>
<span class="linenr"> 2: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">type-bound variables: shape, data</span>
<span class="linenr"> 3: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">type-bound procedures: construct, destruct</span>
<span class="linenr"> 4: </span><span style="color: #0000FF;">type</span> <span style="color: #006699;">matrix</span>
<span class="linenr"> 5: </span>   <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> shape</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">2</span><span style="color: #707183;">)</span>
<span class="linenr"> 6: </span>   <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">allocatable</span> ::<span style="color: #BA36A5;"> data</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">:,:</span><span style="color: #707183;">)</span>
<span class="linenr"> 7: </span> <span style="color: #0000FF;">contains</span>
<span class="linenr"> 8: </span>   <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> construct</span>
<span class="linenr"> 9: </span>   <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> destruct</span>
<span class="linenr">10: </span><span style="color: #0000FF;">end type</span> <span style="color: #006699;">matrix</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">declare a matrix variable</span>
<span class="linenr">13: </span><span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span><span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">assign value to type-bound variable</span>
<span class="linenr">16: </span>mat%shape = <span style="color: #707183;">[</span><span style="color: #D0372D;">3</span>,<span style="color: #D0372D;">3</span><span style="color: #707183;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline53" class="outline-3">
<h3 id="orgheadline53"><span class="section-number-3">7.2</span> Modules</h3>
<div class="outline-text-3" id="text-7-2">
<p>
A type-bound procedure can be defined after the <code>contains</code> keyword in the same program construct, i.e. a <code>module</code>, as the type definition. The first argument in the definition of a type-bound procedure is of the defined type and is declared within the procedure body with the <code>class</code> keyword and the name of the type.
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #0000FF;">module</span> <span style="color: #006699;">matrix_module</span>
<span class="linenr"> 2: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>  <span style="color: #0000FF;">type</span> <span style="color: #006699;">matrix</span>
<span class="linenr"> 5: </span>     <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> shape</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">2</span><span style="color: #707183;">)</span>
<span class="linenr"> 6: </span>     <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">allocatable</span> ::<span style="color: #BA36A5;"> data</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">:,:</span><span style="color: #707183;">)</span>
<span class="linenr"> 7: </span>   <span style="color: #0000FF;">contains</span>
<span class="linenr"> 8: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> construct</span>
<span class="linenr"> 9: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> destruct</span>
<span class="linenr">10: </span>  <span style="color: #0000FF;">end type</span> <span style="color: #006699;">matrix</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #0000FF;">contains</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">construct: populate shape and allocate memory for matrix</span>
<span class="linenr">15: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">m,n: number of rows,cols of matrix</span>
<span class="linenr">16: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">construct</span><span style="color: #707183;">(</span>this, m, n<span style="color: #707183;">)</span>
<span class="linenr">17: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr">18: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> m, n</span>
<span class="linenr">19: </span>    this%shape = <span style="color: #707183;">[</span>m,n<span style="color: #707183;">]</span>
<span class="linenr">20: </span>    <span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>this%data<span style="color: #7388D6;">(</span>m,n<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">21: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">construct</span>
<span class="linenr">22: </span>
<span class="linenr">23: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">destruct: deallocate memory that matrix occupies</span>
<span class="linenr">24: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">destruct</span><span style="color: #707183;">(</span>this<span style="color: #707183;">)</span>
<span class="linenr">25: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr">26: </span>    <span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>this%data<span style="color: #707183;">)</span>
<span class="linenr">27: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">destruct</span>
<span class="linenr">28: </span>
<span class="linenr">29: </span><span style="color: #0000FF;">end module</span> <span style="color: #006699;">matrix_module</span>
</pre>
</div>

<p>
To define variables of the <code>matrix</code> type in the main program, tell it to <code>use</code> the module defined above with <code>use matrix_module</code> immediately after the <code>program main</code> line. The procedures bound to a defined type can be access through variables of that type by appending the <code>%</code> symbol to the name of the variable. 
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr"> 2: </span>  <span style="color: #0000FF;">use</span> <span style="color: #006699;">matrix_module</span>
<span class="linenr"> 3: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>  <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr"> 6: </span>  mat%shape = <span style="color: #707183;">[</span><span style="color: #D0372D;">3</span>,<span style="color: #D0372D;">3</span><span style="color: #707183;">]</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">create matrix</span>
<span class="linenr"> 9: </span>  <span style="color: #0000FF;">call</span> <span style="color: #006699;">mat</span>%construct<span style="color: #707183;">(</span><span style="color: #D0372D;">3</span>,<span style="color: #D0372D;">3</span><span style="color: #707183;">)</span>
<span class="linenr">10: </span>  
<span class="linenr">11: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">treat matrix variable 'data' like an array</span>
<span class="linenr">12: </span>  mat%data<span style="color: #707183;">(</span><span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span> = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">13: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">etc...</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">destruct matrix</span>
<span class="linenr">16: </span>  <span style="color: #0000FF;">call</span> <span style="color: #006699;">matrix</span>%destruct<span style="color: #707183;">()</span>
<span class="linenr">17: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline54" class="outline-3">
<h3 id="orgheadline54"><span class="section-number-3">7.3</span> Example: determinant of random matrix</h3>
<div class="outline-text-3" id="text-7-3">
<p>
The following module defines a <code>matrix</code> type with two variables: an <code>integer</code> array <code>shape</code> that stores the number of rows and columns of the matrix and a <code>real</code> array <code>data</code> that stores the elements of the matrix. The type has four procedures: a subroutine <code>construct</code> that sets the shape and allocates memory for the data, a subroutine <code>destruct</code> that deallocates memory, a subroutine <code>print</code> that prints a matrix, and a function <code>det</code> that computes the determinant of a matrix. Note <code>det</code> is based on the definition of determinant using cofactors, and is very inefficient. A function <code>random_matrix</code> defined within the module generates a matrix with uniform random entries in \([-1,1]\).
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr">  1: </span><span style="color: #0000FF;">module</span> <span style="color: #006699;">matrix_module</span>
<span class="linenr">  2: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr">  3: </span>
<span class="linenr">  4: </span>  <span style="color: #0000FF;">type</span> <span style="color: #006699;">matrix</span>
<span class="linenr">  5: </span>     <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> shape</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">2</span><span style="color: #707183;">)</span>
<span class="linenr">  6: </span>     <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">allocatable</span> ::<span style="color: #BA36A5;"> data</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">:,:</span><span style="color: #707183;">)</span>
<span class="linenr">  7: </span>   <span style="color: #0000FF;">contains</span>
<span class="linenr">  8: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> construct</span>
<span class="linenr">  9: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> destruct</span>
<span class="linenr"> 10: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> print</span>
<span class="linenr"> 11: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> det</span>
<span class="linenr"> 12: </span>  <span style="color: #0000FF;">end type</span> <span style="color: #006699;">matrix</span>
<span class="linenr"> 13: </span>
<span class="linenr"> 14: </span><span style="color: #0000FF;">contains</span>
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">construct</span><span style="color: #707183;">(</span>this, m, n<span style="color: #707183;">)</span>
<span class="linenr"> 17: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr"> 18: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> m,n</span>
<span class="linenr"> 19: </span>    this%shape = <span style="color: #707183;">[</span>m,n<span style="color: #707183;">]</span>
<span class="linenr"> 20: </span>    <span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>this%data<span style="color: #7388D6;">(</span>m,n<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr"> 21: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">construct</span>
<span class="linenr"> 22: </span>
<span class="linenr"> 23: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">destruct</span><span style="color: #707183;">(</span>this<span style="color: #707183;">)</span>
<span class="linenr"> 24: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr"> 25: </span>    <span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>this%data<span style="color: #707183;">)</span>
<span class="linenr"> 26: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">destruct</span>
<span class="linenr"> 27: </span>
<span class="linenr"> 28: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print: formatted print of matrix</span>
<span class="linenr"> 29: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">print</span><span style="color: #707183;">(</span>this<span style="color: #707183;">)</span>
<span class="linenr"> 30: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr"> 31: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">row_fmt: format character string for row printing</span>
<span class="linenr"> 32: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">fmt: temporary format string</span>
<span class="linenr"> 33: </span>    <span style="color: #6434A3;">character</span><span style="color: #707183;">(</span><span style="color: #D0372D;">32</span><span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> row_fmt, fmt = '(a,i0,a,i0,a,i0,a)'</span>
<span class="linenr"> 34: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">w: width of each entry printed</span>
<span class="linenr"> 35: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">d: number of decimal digits printed</span>
<span class="linenr"> 36: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> w, d = 2, row</span>
<span class="linenr"> 37: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">find largest width of element in matrix</span>
<span class="linenr"> 38: </span>    w = <span style="color: #0000FF;">ceiling</span><span style="color: #707183;">(</span><span style="color: #0000FF;">log10</span><span style="color: #7388D6;">(</span><span style="color: #0000FF;">maxval</span><span style="color: #909183;">(</span><span style="color: #0000FF;">abs</span><span style="color: #709870;">(</span>this%data<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> + d + <span style="color: #D0372D;">2</span>
<span class="linenr"> 39: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">write row formatting to 'row_fmt' variable</span>
<span class="linenr"> 40: </span>    <span style="color: #0000FF;">write</span><span style="color: #707183;">(</span>row_fmt,fmt<span style="color: #707183;">)</span> <span style="color: #008000;">'('</span>,this%<span style="color: #0000FF;">shape</span><span style="color: #707183;">(</span><span style="color: #D0372D;">2</span><span style="color: #707183;">)</span>,<span style="color: #008000;">'(f'</span>,w,<span style="color: #008000;">'.'</span>,d,<span style="color: #008000;">',1x))'</span>
<span class="linenr"> 41: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print matrix row by row</span>
<span class="linenr"> 42: </span>    <span style="color: #0000FF;">do</span> row = <span style="color: #D0372D;">1</span>,this%<span style="color: #0000FF;">shape</span><span style="color: #707183;">(</span><span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr"> 43: </span>       <span style="color: #0000FF;">print</span> row_fmt, this%data<span style="color: #707183;">(</span>row,:<span style="color: #707183;">)</span>
<span class="linenr"> 44: </span>    <span style="color: #0000FF;">end do</span>
<span class="linenr"> 45: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">print</span>
<span class="linenr"> 46: </span>
<span class="linenr"> 47: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">det: compute determinant of matrix</span>
<span class="linenr"> 48: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">using recursive definition based on cofactors</span>
<span class="linenr"> 49: </span>  <span style="color: #0000FF;">recursive</span> <span style="color: #0000FF;">function</span> <span style="color: #006699;">det</span><span style="color: #707183;">(</span>this<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>d<span style="color: #707183;">)</span>
<span class="linenr"> 50: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr"> 51: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">submatrix</span>
<span class="linenr"> 52: </span>    <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> d, sgn, element, minor</span>
<span class="linenr"> 53: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> m, n, row, col, i, j</span>
<span class="linenr"> 54: </span>
<span class="linenr"> 55: </span>    m = this%<span style="color: #0000FF;">shape</span><span style="color: #707183;">(</span><span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr"> 56: </span>    n = this%<span style="color: #0000FF;">shape</span><span style="color: #707183;">(</span><span style="color: #D0372D;">2</span><span style="color: #707183;">)</span>
<span class="linenr"> 57: </span>    d = <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0</span>
<span class="linenr"> 58: </span>
<span class="linenr"> 59: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">compute cofactor</span>
<span class="linenr"> 60: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">if 1x1 matrix, return value</span>
<span class="linenr"> 61: </span>    <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>m==<span style="color: #D0372D;">1</span><span style="color: #0000FF;">.and.</span>n==<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr"> 62: </span>       d = this%data<span style="color: #707183;">(</span><span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr"> 63: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">if square and not 1x1</span>
<span class="linenr"> 64: </span>    <span style="color: #0000FF;">else if</span> <span style="color: #707183;">(</span>m==n<span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr"> 65: </span>       <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">cofactor sum down the first column</span>
<span class="linenr"> 66: </span>       <span style="color: #0000FF;">do</span> row = <span style="color: #D0372D;">1</span>,m
<span class="linenr"> 67: </span>          <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">sign of term</span>
<span class="linenr"> 68: </span>          sgn = <span style="color: #707183;">(</span>-<span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span><span style="color: #707183;">)</span>**<span style="color: #707183;">(</span>row+<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr"> 69: </span>          <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">matrix element</span>
<span class="linenr"> 70: </span>          element = this%data<span style="color: #707183;">(</span>row,<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr"> 71: </span>          <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">construct the cofactor submatrix and compute its determinant</span>
<span class="linenr"> 72: </span>          <span style="color: #0000FF;">call</span> <span style="color: #006699;">submatrix</span>%construct<span style="color: #707183;">(</span>m-<span style="color: #D0372D;">1</span>,n-<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr"> 73: </span>          <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>row==<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr"> 74: </span>             submatrix%data = this%data<span style="color: #707183;">(</span><span style="color: #D0372D;">2</span>:,<span style="color: #D0372D;">2</span>:<span style="color: #707183;">)</span>
<span class="linenr"> 75: </span>          <span style="color: #0000FF;">else if</span> <span style="color: #707183;">(</span>row==m<span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr"> 76: </span>             submatrix%data = this%data<span style="color: #707183;">(</span>:m-<span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">2</span>:<span style="color: #707183;">)</span>
<span class="linenr"> 77: </span>          <span style="color: #0000FF;">else</span>
<span class="linenr"> 78: </span>             submatrix%data<span style="color: #707183;">(</span>:row-<span style="color: #D0372D;">1</span>,:<span style="color: #707183;">)</span> = this%data<span style="color: #707183;">(</span>:row-<span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">2</span>:<span style="color: #707183;">)</span>
<span class="linenr"> 79: </span>             submatrix%data<span style="color: #707183;">(</span>row:,:<span style="color: #707183;">)</span> = this%data<span style="color: #707183;">(</span>row+<span style="color: #D0372D;">1</span>:,<span style="color: #D0372D;">2</span>:<span style="color: #707183;">)</span>
<span class="linenr"> 80: </span>          <span style="color: #0000FF;">end if</span>
<span class="linenr"> 81: </span>          minor = submatrix%det<span style="color: #707183;">()</span>
<span class="linenr"> 82: </span>          <span style="color: #0000FF;">call</span> <span style="color: #006699;">submatrix</span>%destruct<span style="color: #707183;">()</span>
<span class="linenr"> 83: </span>
<span class="linenr"> 84: </span>          <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">determinant accumulator</span>
<span class="linenr"> 85: </span>          d = d + sgn*element*minor
<span class="linenr"> 86: </span>       <span style="color: #0000FF;">end do</span>
<span class="linenr"> 87: </span>    <span style="color: #0000FF;">end if</span>
<span class="linenr"> 88: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">det</span>
<span class="linenr"> 89: </span>
<span class="linenr"> 90: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">random_matrix: generate matrix with random entries in [-1,1]</span>
<span class="linenr"> 91: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">m,n: number of rows,cols</span>
<span class="linenr"> 92: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">random_matrix</span><span style="color: #707183;">(</span>m,n<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>mat<span style="color: #707183;">)</span>
<span class="linenr"> 93: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> m,n,i,j</span>
<span class="linenr"> 94: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr"> 95: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">allocate memory for matrix</span>
<span class="linenr"> 96: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">mat</span>%construct<span style="color: #707183;">(</span>m,n<span style="color: #707183;">)</span>
<span class="linenr"> 97: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">seed random number generator</span>
<span class="linenr"> 98: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">srand</span><span style="color: #707183;">(</span>time<span style="color: #7388D6;">()</span><span style="color: #707183;">)</span>
<span class="linenr"> 99: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">populate matrix</span>
<span class="linenr">100: </span>    <span style="color: #0000FF;">do</span> i = <span style="color: #D0372D;">1</span>,m
<span class="linenr">101: </span>       <span style="color: #0000FF;">do</span> j = <span style="color: #D0372D;">1</span>,n
<span class="linenr">102: </span>          mat%data<span style="color: #707183;">(</span>i,j<span style="color: #707183;">)</span> = <span style="color: #D0372D;">2</span>.<span style="color: #D0372D;">0</span>*rand<span style="color: #707183;">()</span> - <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">103: </span>       <span style="color: #0000FF;">end do</span>
<span class="linenr">104: </span>    <span style="color: #0000FF;">end do</span>
<span class="linenr">105: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">random_matrix</span>
<span class="linenr">106: </span>
<span class="linenr">107: </span><span style="color: #0000FF;">end module</span> <span style="color: #006699;">matrix_module</span>
</pre>
</div>

<p>
The main program uses the <code>matrix_module</code> defined above to find the determinants of a number of random matrices of increasing size. 
</p>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr"> 2: </span>  <span style="color: #0000FF;">use</span> <span style="color: #006699;">matrix_module</span>
<span class="linenr"> 3: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>  <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr"> 6: </span>  <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> n</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">compute determinants of random matrices</span>
<span class="linenr"> 9: </span>  <span style="color: #0000FF;">do</span> n = <span style="color: #D0372D;">1</span>,<span style="color: #D0372D;">5</span>
<span class="linenr">10: </span>     <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">generate random  matrix</span>
<span class="linenr">11: </span>     mat = random_matrix<span style="color: #707183;">(</span>n,n<span style="color: #707183;">)</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span>     <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">print determinant of matrix</span>
<span class="linenr">14: </span>     <span style="color: #0000FF;">print</span> <span style="color: #008000;">"('n: ', i0, ', det: ', f0.5)"</span>, n, det<span style="color: #707183;">(</span>mat<span style="color: #707183;">)</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span>     <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">destruct matrix</span>
<span class="linenr">17: </span>     <span style="color: #0000FF;">call</span> <span style="color: #006699;">mat</span>%destruct<span style="color: #707183;">()</span>
<span class="linenr">18: </span>  <span style="color: #0000FF;">end do</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">./main
</pre>
</div>

<pre class="example">
n: 1, det: -.68676
n: 2, det: .45054
n: 3, det: .37319
n: 4, det: -.27328
n: 5, det: .26695
</pre>
</div>
</div>

<div id="outline-container-orgheadline55" class="outline-3">
<h3 id="orgheadline55"><span class="section-number-3">7.4</span> Example: matrix module</h3>
<div class="outline-text-3" id="text-7-4">
<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr">  1: </span><span style="color: #0000FF;">module</span> <span style="color: #006699;">matrix_module</span>
<span class="linenr">  2: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr">  3: </span>
<span class="linenr">  4: </span>  <span style="color: #0000FF;">public</span> :: zeros
<span class="linenr">  5: </span>  <span style="color: #0000FF;">public</span> :: identity
<span class="linenr">  6: </span>  <span style="color: #0000FF;">public</span> :: random
<span class="linenr">  7: </span>
<span class="linenr">  8: </span>  <span style="color: #0000FF;">type</span> <span style="color: #006699;">matrix</span>
<span class="linenr">  9: </span>     <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> shape</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">2</span><span style="color: #707183;">)</span>
<span class="linenr"> 10: </span>     <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">allocatable</span> ::<span style="color: #BA36A5;"> data</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">:,:</span><span style="color: #707183;">)</span>
<span class="linenr"> 11: </span>   <span style="color: #0000FF;">contains</span>
<span class="linenr"> 12: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> construct =&gt; matrix_construct</span>
<span class="linenr"> 13: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> destruct =&gt; matrix_destruct</span>
<span class="linenr"> 14: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> norm =&gt; matrix_norm</span>
<span class="linenr"> 15: </span>  <span style="color: #0000FF;">end type</span> <span style="color: #006699;">matrix</span>
<span class="linenr"> 16: </span>
<span class="linenr"> 17: </span>  <span style="color: #0000FF;">type</span> <span style="color: #006699;">vector</span>
<span class="linenr"> 18: </span>     <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> length</span>
<span class="linenr"> 19: </span>     <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">allocatable</span> ::<span style="color: #BA36A5;"> data</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">:</span><span style="color: #707183;">)</span>
<span class="linenr"> 20: </span>   <span style="color: #0000FF;">contains</span>
<span class="linenr"> 21: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> construct =&gt; vector_construct</span>
<span class="linenr"> 22: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> destruct =&gt; vector_destruct</span>
<span class="linenr"> 23: </span>     <span style="color: #6434A3;">procedure</span> ::<span style="color: #BA36A5;"> norm =&gt; vector_norm</span>
<span class="linenr"> 24: </span>  <span style="color: #0000FF;">end type</span> <span style="color: #006699;">vector</span>
<span class="linenr"> 25: </span>
<span class="linenr"> 26: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">assignments</span>
<span class="linenr"> 27: </span>  <span style="color: #0000FF;">interface assignment</span><span style="color: #707183;">(</span>=<span style="color: #707183;">)</span>
<span class="linenr"> 28: </span>     <span style="color: #6434A3;">procedure</span><span style="color: #BA36A5;"> vec_num_assign, vec_vec_assign, mat_num_assign, mat_mat_assign</span>
<span class="linenr"> 29: </span>  <span style="color: #0000FF;">end interface assignment</span><span style="color: #707183;">(</span>=<span style="color: #707183;">)</span>
<span class="linenr"> 30: </span>
<span class="linenr"> 31: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">operations</span>
<span class="linenr"> 32: </span>  <span style="color: #0000FF;">interface operator</span><span style="color: #707183;">(</span>+<span style="color: #707183;">)</span>
<span class="linenr"> 33: </span>     <span style="color: #6434A3;">procedure</span><span style="color: #BA36A5;"> vec_vec_sum, mat_mat_sum</span>
<span class="linenr"> 34: </span>  <span style="color: #0000FF;">end interface operator</span><span style="color: #707183;">(</span>+<span style="color: #707183;">)</span>
<span class="linenr"> 35: </span>
<span class="linenr"> 36: </span>  <span style="color: #0000FF;">interface operator</span><span style="color: #707183;">(</span>-<span style="color: #707183;">)</span>
<span class="linenr"> 37: </span>     <span style="color: #6434A3;">procedure</span><span style="color: #BA36A5;"> vec_vec_diff, mat_mat_diff</span>
<span class="linenr"> 38: </span>  <span style="color: #0000FF;">end interface operator</span><span style="color: #707183;">(</span>-<span style="color: #707183;">)</span>
<span class="linenr"> 39: </span>
<span class="linenr"> 40: </span>  <span style="color: #0000FF;">interface operator</span><span style="color: #707183;">(</span>*<span style="color: #707183;">)</span>
<span class="linenr"> 41: </span>     <span style="color: #6434A3;">procedure</span><span style="color: #BA36A5;"> num_vec_prod, num_mat_prod, mat_vec_prod, mat_mat_prod</span>
<span class="linenr"> 42: </span>  <span style="color: #0000FF;">end interface operator</span><span style="color: #707183;">(</span>*<span style="color: #707183;">)</span>
<span class="linenr"> 43: </span>
<span class="linenr"> 44: </span>  <span style="color: #0000FF;">interface operator</span><span style="color: #707183;">(</span>/<span style="color: #707183;">)</span>
<span class="linenr"> 45: </span>     <span style="color: #6434A3;">procedure</span><span style="color: #BA36A5;"> vec_num_quot, mat_num_quot</span>
<span class="linenr"> 46: </span>  <span style="color: #0000FF;">end interface operator</span><span style="color: #707183;">(</span>/<span style="color: #707183;">)</span>
<span class="linenr"> 47: </span>
<span class="linenr"> 48: </span>  <span style="color: #0000FF;">interface operator</span><span style="color: #707183;">(</span>**<span style="color: #707183;">)</span>
<span class="linenr"> 49: </span>     <span style="color: #6434A3;">procedure</span><span style="color: #BA36A5;"> mat_pow</span>
<span class="linenr"> 50: </span>  <span style="color: #0000FF;">end interface operator</span><span style="color: #707183;">(</span>**<span style="color: #707183;">)</span>
<span class="linenr"> 51: </span>
<span class="linenr"> 52: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">functions</span>
<span class="linenr"> 53: </span>  <span style="color: #0000FF;">interface</span> <span style="color: #006699;">norm</span>
<span class="linenr"> 54: </span>     <span style="color: #6434A3;">procedure</span><span style="color: #BA36A5;"> vector_norm, matrix_norm</span>
<span class="linenr"> 55: </span>  <span style="color: #0000FF;">end interface</span> <span style="color: #006699;">norm</span>
<span class="linenr"> 56: </span>
<span class="linenr"> 57: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">structured vectors/matrices</span>
<span class="linenr"> 58: </span>  <span style="color: #0000FF;">interface</span> <span style="color: #006699;">zeros</span>
<span class="linenr"> 59: </span>     <span style="color: #6434A3;">procedure</span><span style="color: #BA36A5;"> zeros_vector, zeros_matrix</span>
<span class="linenr"> 60: </span>  <span style="color: #0000FF;">end interface</span> <span style="color: #006699;">zeros</span>
<span class="linenr"> 61: </span>
<span class="linenr"> 62: </span>  <span style="color: #0000FF;">interface</span> <span style="color: #006699;">random</span>
<span class="linenr"> 63: </span>     <span style="color: #6434A3;">procedure</span><span style="color: #BA36A5;"> random_vector, random_matrix</span>
<span class="linenr"> 64: </span>  <span style="color: #0000FF;">end interface</span> <span style="color: #006699;">random</span>
<span class="linenr"> 65: </span>
<span class="linenr"> 66: </span><span style="color: #0000FF;">contains</span>
<span class="linenr"> 67: </span>
<span class="linenr"> 68: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">matrix_construct</span><span style="color: #707183;">(</span>this, m, n<span style="color: #707183;">)</span>
<span class="linenr"> 69: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr"> 70: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> m,n</span>
<span class="linenr"> 71: </span>    this%shape = <span style="color: #707183;">[</span>m,n<span style="color: #707183;">]</span>
<span class="linenr"> 72: </span>    <span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>this%data<span style="color: #7388D6;">(</span>m,n<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr"> 73: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">matrix_construct</span>
<span class="linenr"> 74: </span>
<span class="linenr"> 75: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">vector_construct</span><span style="color: #707183;">(</span>this, n<span style="color: #707183;">)</span>
<span class="linenr"> 76: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr"> 77: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> n</span>
<span class="linenr"> 78: </span>    this%length = n
<span class="linenr"> 79: </span>    <span style="color: #0000FF;">allocate</span><span style="color: #707183;">(</span>this%data<span style="color: #7388D6;">(</span>n<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr"> 80: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">vector_construct</span>
<span class="linenr"> 81: </span>
<span class="linenr"> 82: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">matrix_destruct</span><span style="color: #707183;">(</span>this<span style="color: #707183;">)</span>
<span class="linenr"> 83: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr"> 84: </span>    <span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>this%data<span style="color: #707183;">)</span>
<span class="linenr"> 85: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">matrix_destruct</span>
<span class="linenr"> 86: </span>
<span class="linenr"> 87: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">vector_destruct</span><span style="color: #707183;">(</span>this<span style="color: #707183;">)</span>
<span class="linenr"> 88: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr"> 89: </span>    <span style="color: #0000FF;">deallocate</span><span style="color: #707183;">(</span>this%data<span style="color: #707183;">)</span>
<span class="linenr"> 90: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">vector_destruct</span>
<span class="linenr"> 91: </span>
<span class="linenr"> 92: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">assignment</span>
<span class="linenr"> 93: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">vec_num_assign</span><span style="color: #707183;">(</span>vec,num<span style="color: #707183;">)</span>
<span class="linenr"> 94: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>inout<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec</span>
<span class="linenr"> 95: </span>    <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> num</span>
<span class="linenr"> 96: </span>    vec%data = num
<span class="linenr"> 97: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">vec_num_assign</span>
<span class="linenr"> 98: </span>
<span class="linenr"> 99: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">vec_vec_assign</span><span style="color: #707183;">(</span>vec1,vec2<span style="color: #707183;">)</span>
<span class="linenr">100: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>inout<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec1</span>
<span class="linenr">101: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec2</span>
<span class="linenr">102: </span>    vec1%data = vec2%data
<span class="linenr">103: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">vec_vec_assign</span>
<span class="linenr">104: </span>
<span class="linenr">105: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">mat_num_assign</span><span style="color: #707183;">(</span>mat,num<span style="color: #707183;">)</span>
<span class="linenr">106: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>inout<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr">107: </span>    <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> num</span>
<span class="linenr">108: </span>    mat%data = num
<span class="linenr">109: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">mat_num_assign</span>
<span class="linenr">110: </span>
<span class="linenr">111: </span>  <span style="color: #0000FF;">subroutine</span> <span style="color: #006699;">mat_mat_assign</span><span style="color: #707183;">(</span>mat1,mat2<span style="color: #707183;">)</span>
<span class="linenr">112: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>inout<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat1</span>
<span class="linenr">113: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat2</span>
<span class="linenr">114: </span>    mat1%data = mat2%data
<span class="linenr">115: </span>  <span style="color: #0000FF;">end subroutine</span> <span style="color: #006699;">mat_mat_assign</span>
<span class="linenr">116: </span>
<span class="linenr">117: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">operations</span>
<span class="linenr">118: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">vec_vec_sum</span><span style="color: #707183;">(</span>vec1,vec2<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>s<span style="color: #707183;">)</span>
<span class="linenr">119: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec1, vec2</span>
<span class="linenr">120: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">s</span>
<span class="linenr">121: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">s</span>%construct<span style="color: #707183;">(</span>vec1%length<span style="color: #707183;">)</span>
<span class="linenr">122: </span>    s%data = vec1%data + vec2%data
<span class="linenr">123: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">vec_vec_sum</span>
<span class="linenr">124: </span>
<span class="linenr">125: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">mat_mat_sum</span><span style="color: #707183;">(</span>mat1,mat2<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>s<span style="color: #707183;">)</span>
<span class="linenr">126: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat1, mat2</span>
<span class="linenr">127: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">s</span>
<span class="linenr">128: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">s</span>%construct<span style="color: #707183;">(</span>mat1%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span>,mat1%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">2</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">129: </span>    s%data = mat1%data+mat2%data
<span class="linenr">130: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">mat_mat_sum</span>
<span class="linenr">131: </span>
<span class="linenr">132: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">vec_vec_diff</span><span style="color: #707183;">(</span>vec1,vec2<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>diff<span style="color: #707183;">)</span>
<span class="linenr">133: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec1, vec2</span>
<span class="linenr">134: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">diff</span>
<span class="linenr">135: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">diff</span>%construct<span style="color: #707183;">(</span>vec1%length<span style="color: #707183;">)</span>
<span class="linenr">136: </span>    diff%data = vec1%data-vec2%data
<span class="linenr">137: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">vec_vec_diff</span>
<span class="linenr">138: </span>
<span class="linenr">139: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">mat_mat_diff</span><span style="color: #707183;">(</span>mat1,mat2<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>diff<span style="color: #707183;">)</span>
<span class="linenr">140: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat1, mat2</span>
<span class="linenr">141: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">diff</span>
<span class="linenr">142: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">diff</span>%construct<span style="color: #707183;">(</span>mat1%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span>,mat1%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">2</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">143: </span>    diff%data = mat1%data-mat2%data
<span class="linenr">144: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">mat_mat_diff</span>
<span class="linenr">145: </span>
<span class="linenr">146: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">num_vec_prod</span><span style="color: #707183;">(</span>num,vec<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>prod<span style="color: #707183;">)</span>
<span class="linenr">147: </span>    <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> num</span>
<span class="linenr">148: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec</span>
<span class="linenr">149: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">prod</span>
<span class="linenr">150: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">prod</span>%construct<span style="color: #707183;">(</span>vec%length<span style="color: #707183;">)</span>
<span class="linenr">151: </span>    prod%data = num*vec%data
<span class="linenr">152: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">num_vec_prod</span>
<span class="linenr">153: </span>
<span class="linenr">154: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">num_mat_prod</span><span style="color: #707183;">(</span>num,mat<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>prod<span style="color: #707183;">)</span>
<span class="linenr">155: </span>    <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> num</span>
<span class="linenr">156: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr">157: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">prod</span>
<span class="linenr">158: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">prod</span>%construct<span style="color: #707183;">(</span>mat%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span>,mat%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">2</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">159: </span>    prod%data = num*mat%data
<span class="linenr">160: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">num_mat_prod</span>
<span class="linenr">161: </span>
<span class="linenr">162: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">mat_vec_prod</span><span style="color: #707183;">(</span>mat,vec<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>prod<span style="color: #707183;">)</span>
<span class="linenr">163: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr">164: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec</span>
<span class="linenr">165: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">prod</span>
<span class="linenr">166: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">prod</span>%construct<span style="color: #707183;">(</span>mat%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">167: </span>    prod%data = <span style="color: #0000FF;">matmul</span><span style="color: #707183;">(</span>mat%data,vec%data<span style="color: #707183;">)</span>
<span class="linenr">168: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">mat_vec_prod</span>
<span class="linenr">169: </span>
<span class="linenr">170: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">mat_mat_prod</span><span style="color: #707183;">(</span>mat1,mat2<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>prod<span style="color: #707183;">)</span>
<span class="linenr">171: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat1, mat2</span>
<span class="linenr">172: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">prod</span>
<span class="linenr">173: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">prod</span>%construct<span style="color: #707183;">(</span>mat1%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span>,mat2%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">2</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">174: </span>    prod%data = <span style="color: #0000FF;">matmul</span><span style="color: #707183;">(</span>mat1%data,mat2%data<span style="color: #707183;">)</span>
<span class="linenr">175: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">mat_mat_prod</span>
<span class="linenr">176: </span>
<span class="linenr">177: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">vec_num_quot</span><span style="color: #707183;">(</span>vec,num<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>quot<span style="color: #707183;">)</span>
<span class="linenr">178: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec</span>
<span class="linenr">179: </span>    <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> num</span>
<span class="linenr">180: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">quot</span>
<span class="linenr">181: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">quot</span>%construct<span style="color: #707183;">(</span>vec%length<span style="color: #707183;">)</span>
<span class="linenr">182: </span>    quot%data = vec%data/num
<span class="linenr">183: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">vec_num_quot</span>
<span class="linenr">184: </span>
<span class="linenr">185: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">mat_num_quot</span><span style="color: #707183;">(</span>mat,num<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>quot<span style="color: #707183;">)</span>
<span class="linenr">186: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr">187: </span>    <span style="color: #6434A3;">real</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> num</span>
<span class="linenr">188: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">quot</span>
<span class="linenr">189: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">quot</span>%construct<span style="color: #707183;">(</span>mat%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span>,mat%<span style="color: #0000FF;">shape</span><span style="color: #7388D6;">(</span><span style="color: #D0372D;">2</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">190: </span>    quot%data = mat%data/num
<span class="linenr">191: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">mat_num_quot</span>
<span class="linenr">192: </span>
<span class="linenr">193: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">mat_pow</span><span style="color: #707183;">(</span>mat1,pow<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>mat2<span style="color: #707183;">)</span>
<span class="linenr">194: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat1</span>
<span class="linenr">195: </span>    <span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> pow</span>
<span class="linenr">196: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat2</span>
<span class="linenr">197: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> i</span>
<span class="linenr">198: </span>    mat2 = mat1
<span class="linenr">199: </span>    <span style="color: #0000FF;">do</span> i = <span style="color: #D0372D;">2</span>,pow
<span class="linenr">200: </span>       mat2 = mat1*mat2
<span class="linenr">201: </span>    <span style="color: #0000FF;">end do</span>
<span class="linenr">202: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">mat_pow</span>
<span class="linenr">203: </span>
<span class="linenr">204: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">functions</span>
<span class="linenr">205: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">vector_norm</span><span style="color: #707183;">(</span>this,p<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>mag<span style="color: #707183;">)</span>
<span class="linenr">206: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr">207: </span>    <span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> p</span>
<span class="linenr">208: </span>    <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> mag</span>
<span class="linenr">209: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> i</span>
<span class="linenr">210: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">inf-norm</span>
<span class="linenr">211: </span>    <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>p==<span style="color: #D0372D;">0</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">212: </span>       mag = <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">213: </span>       <span style="color: #0000FF;">do</span> i = <span style="color: #D0372D;">1</span>,this%length
<span class="linenr">214: </span>          mag = <span style="color: #0000FF;">max</span><span style="color: #707183;">(</span>mag,<span style="color: #0000FF;">abs</span><span style="color: #7388D6;">(</span>this%data<span style="color: #909183;">(</span>i<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">215: </span>       <span style="color: #0000FF;">end do</span>
<span class="linenr">216: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">p-norm</span>
<span class="linenr">217: </span>    <span style="color: #0000FF;">else if</span> <span style="color: #707183;">(</span>p&gt;0<span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">218: </span>       mag = <span style="color: #707183;">(</span><span style="color: #0000FF;">sum</span><span style="color: #7388D6;">(</span><span style="color: #0000FF;">abs</span><span style="color: #909183;">(</span>this%data<span style="color: #909183;">)</span>**p<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>**<span style="color: #707183;">(</span><span style="color: #D0372D;">1</span>./p<span style="color: #707183;">)</span>
<span class="linenr">219: </span>    <span style="color: #0000FF;">end if</span>
<span class="linenr">220: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">vector_norm</span>
<span class="linenr">221: </span>
<span class="linenr">222: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">matrix_norm</span><span style="color: #707183;">(</span>this, p<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>mag<span style="color: #707183;">)</span>
<span class="linenr">223: </span>    <span style="color: #6434A3;">class</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">this</span>
<span class="linenr">224: </span>    <span style="color: #6434A3;">integer</span>, <span style="color: #0000FF;">intent</span><span style="color: #707183;">(</span>in<span style="color: #707183;">)</span> ::<span style="color: #BA36A5;"> p</span>
<span class="linenr">225: </span>    <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;">  mag, tol = 1e-6</span>
<span class="linenr">226: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> m, n, row, col, iter, max_iters = 1000</span>
<span class="linenr">227: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec, last_vec</span>
<span class="linenr">228: </span>    m = <span style="color: #0000FF;">size</span><span style="color: #707183;">(</span>this%data<span style="color: #7388D6;">(</span>:,<span style="color: #D0372D;">1</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>; n = <span style="color: #0000FF;">size</span><span style="color: #707183;">(</span>this%data<span style="color: #7388D6;">(</span><span style="color: #D0372D;">1</span>,:<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">229: </span>
<span class="linenr">230: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">entry-wise norms</span>
<span class="linenr">231: </span>    <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>p&lt;0<span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">232: </span>       mag = <span style="color: #707183;">(</span><span style="color: #0000FF;">sum</span><span style="color: #7388D6;">(</span><span style="color: #0000FF;">abs</span><span style="color: #909183;">(</span>this%data<span style="color: #909183;">)</span>**<span style="color: #909183;">(</span>-p<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>**<span style="color: #707183;">(</span>-<span style="color: #D0372D;">1</span>./p<span style="color: #707183;">)</span>
<span class="linenr">233: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">inf-norm</span>
<span class="linenr">234: </span>    <span style="color: #0000FF;">else if</span> <span style="color: #707183;">(</span>p==<span style="color: #D0372D;">0</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">235: </span>       mag = <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">236: </span>       <span style="color: #0000FF;">do</span> row = <span style="color: #D0372D;">1</span>,m
<span class="linenr">237: </span>          mag = <span style="color: #0000FF;">max</span><span style="color: #707183;">(</span>mag,<span style="color: #0000FF;">sum</span><span style="color: #7388D6;">(</span><span style="color: #0000FF;">abs</span><span style="color: #909183;">(</span>this%data<span style="color: #709870;">(</span>row,:<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">238: </span>       <span style="color: #0000FF;">end do</span>
<span class="linenr">239: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">1-norm</span>
<span class="linenr">240: </span>    <span style="color: #0000FF;">else if</span> <span style="color: #707183;">(</span>p==<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">241: </span>       mag = <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">242: </span>       <span style="color: #0000FF;">do</span> col = <span style="color: #D0372D;">1</span>,n
<span class="linenr">243: </span>          mag = <span style="color: #0000FF;">max</span><span style="color: #707183;">(</span>mag,<span style="color: #0000FF;">sum</span><span style="color: #7388D6;">(</span><span style="color: #0000FF;">abs</span><span style="color: #909183;">(</span>this%data<span style="color: #709870;">(</span>:,col<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span class="linenr">244: </span>       <span style="color: #0000FF;">end do</span>
<span class="linenr">245: </span>    <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">p-norm</span>
<span class="linenr">246: </span>    <span style="color: #0000FF;">else if</span> <span style="color: #707183;">(</span>p&gt;0<span style="color: #707183;">)</span> <span style="color: #0000FF;">then</span>
<span class="linenr">247: </span>       vec = random<span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>
<span class="linenr">248: </span>       vec = vec/vec%norm<span style="color: #707183;">(</span>p<span style="color: #707183;">)</span>
<span class="linenr">249: </span>       last_vec = zeros<span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>
<span class="linenr">250: </span>       mag = <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">251: </span>       <span style="color: #0000FF;">do</span> iter = <span style="color: #D0372D;">1</span>,max_iters
<span class="linenr">252: </span>          last_vec = vec
<span class="linenr">253: </span>          vec = this*last_vec
<span class="linenr">254: </span>          vec = vec/vec%norm<span style="color: #707183;">(</span>p<span style="color: #707183;">)</span>
<span class="linenr">255: </span>          <span style="color: #0000FF;">if</span> <span style="color: #707183;">(</span>vector_norm<span style="color: #7388D6;">(</span>vec-last_vec,p<span style="color: #7388D6;">)</span>&lt;tol<span style="color: #707183;">)</span> <span style="color: #0000FF;">exit</span>
<span class="linenr">256: </span>       <span style="color: #0000FF;">end do</span>
<span class="linenr">257: </span>       mag = vector_norm<span style="color: #707183;">(</span>this*vec,p<span style="color: #707183;">)</span>
<span class="linenr">258: </span>    <span style="color: #0000FF;">end if</span>
<span class="linenr">259: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">matrix_norm</span>
<span class="linenr">260: </span>
<span class="linenr">261: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">structured vectors/matrices</span>
<span class="linenr">262: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">random_matrix</span><span style="color: #707183;">(</span>m,n<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>mat<span style="color: #707183;">)</span>
<span class="linenr">263: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> m,n</span>
<span class="linenr">264: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr">265: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">mat</span>%construct<span style="color: #707183;">(</span>m,n<span style="color: #707183;">)</span>
<span class="linenr">266: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">random_seed</span><span style="color: #707183;">()</span>
<span class="linenr">267: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">random_number</span><span style="color: #707183;">(</span>mat%data<span style="color: #707183;">)</span>
<span class="linenr">268: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">random_matrix</span>
<span class="linenr">269: </span>
<span class="linenr">270: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">random_vector</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>vec<span style="color: #707183;">)</span>
<span class="linenr">271: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> n</span>
<span class="linenr">272: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec</span>
<span class="linenr">273: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">vec</span>%construct<span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>
<span class="linenr">274: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">random_seed</span><span style="color: #707183;">()</span>
<span class="linenr">275: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">random_number</span><span style="color: #707183;">(</span>vec%data<span style="color: #707183;">)</span>
<span class="linenr">276: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">random_vector</span>
<span class="linenr">277: </span>
<span class="linenr">278: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">zeros_vector</span><span style="color: #707183;">(</span>n<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>vec<span style="color: #707183;">)</span>
<span class="linenr">279: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> n</span>
<span class="linenr">280: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec</span>
<span class="linenr">281: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">vec</span>%construct<span style="color: #707183;">(</span>n<span style="color: #707183;">)</span>
<span class="linenr">282: </span>    vec = <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">283: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">zeros_vector</span>
<span class="linenr">284: </span>
<span class="linenr">285: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">zeros_matrix</span><span style="color: #707183;">(</span>m,n<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>mat<span style="color: #707183;">)</span>
<span class="linenr">286: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> m,n</span>
<span class="linenr">287: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr">288: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">mat</span>%construct<span style="color: #707183;">(</span>m,n<span style="color: #707183;">)</span>
<span class="linenr">289: </span>    mat = <span style="color: #D0372D;">0</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">290: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">zeros_matrix</span>
<span class="linenr">291: </span>
<span class="linenr">292: </span>  <span style="color: #0000FF;">function</span> <span style="color: #006699;">identity</span><span style="color: #707183;">(</span>m,n<span style="color: #707183;">)</span> <span style="color: #0000FF;">result</span><span style="color: #707183;">(</span>mat<span style="color: #707183;">)</span>
<span class="linenr">293: </span>    <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> m,n,i</span>
<span class="linenr">294: </span>    <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat</span>
<span class="linenr">295: </span>    <span style="color: #0000FF;">call</span> <span style="color: #006699;">mat</span>%construct<span style="color: #707183;">(</span>m,n<span style="color: #707183;">)</span>
<span class="linenr">296: </span>    <span style="color: #0000FF;">do</span> i = <span style="color: #D0372D;">1</span>,<span style="color: #0000FF;">min</span><span style="color: #707183;">(</span>m,n<span style="color: #707183;">)</span>
<span class="linenr">297: </span>       mat%data<span style="color: #707183;">(</span>i,i<span style="color: #707183;">)</span> = <span style="color: #D0372D;">1</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">298: </span>    <span style="color: #0000FF;">end do</span>
<span class="linenr">299: </span>  <span style="color: #0000FF;">end function</span> <span style="color: #006699;">identity</span>
<span class="linenr">300: </span>
<span class="linenr">301: </span><span style="color: #0000FF;">end module</span> <span style="color: #006699;">matrix_module</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-fortran"><span class="linenr"> 1: </span><span style="color: #0000FF;">program</span> <span style="color: #006699;">main</span>
<span class="linenr"> 2: </span>  <span style="color: #0000FF;">use</span> <span style="color: #006699;">matrix_module</span>
<span class="linenr"> 3: </span>  <span style="color: #0000FF;">implicit</span> <span style="color: #6434A3;">none</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>  <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">vector</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">vec1, vec2</span>
<span class="linenr"> 6: </span>  <span style="color: #6434A3;">type</span><span style="color: #707183;">(</span><span style="color: #6434A3;">matrix</span><span style="color: #707183;">)</span> :: <span style="color: #BA36A5;">mat1, mat2</span>
<span class="linenr"> 7: </span>  <span style="color: #6434A3;">real</span> ::<span style="color: #BA36A5;"> x</span>
<span class="linenr"> 8: </span>  <span style="color: #6434A3;">integer</span> ::<span style="color: #BA36A5;"> i</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">0s, id, random</span>
<span class="linenr">11: </span>  mat1 = zeros<span style="color: #707183;">(</span><span style="color: #D0372D;">3</span>,<span style="color: #D0372D;">3</span><span style="color: #707183;">)</span>
<span class="linenr">12: </span>  <span style="color: #0000FF;">call</span> <span style="color: #006699;">mat1</span>%destruct<span style="color: #707183;">()</span>
<span class="linenr">13: </span>  mat1 = identity<span style="color: #707183;">(</span><span style="color: #D0372D;">3</span>,<span style="color: #D0372D;">3</span><span style="color: #707183;">)</span>
<span class="linenr">14: </span>  mat2 = random<span style="color: #707183;">(</span><span style="color: #D0372D;">3</span>,<span style="color: #D0372D;">3</span><span style="color: #707183;">)</span>
<span class="linenr">15: </span>  mat1 = mat1*mat1
<span class="linenr">16: </span>  vec1 = zeros<span style="color: #707183;">(</span><span style="color: #D0372D;">3</span><span style="color: #707183;">)</span>
<span class="linenr">17: </span>  <span style="color: #0000FF;">call</span> <span style="color: #006699;">vec1</span>%destruct<span style="color: #707183;">()</span>
<span class="linenr">18: </span>  vec1 = random<span style="color: #707183;">(</span><span style="color: #D0372D;">3</span><span style="color: #707183;">)</span>
<span class="linenr">19: </span>  vec2 = random<span style="color: #707183;">(</span><span style="color: #D0372D;">3</span><span style="color: #707183;">)</span>
<span class="linenr">20: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">+,-,*,/,**</span>
<span class="linenr">21: </span>  mat1 = mat1+mat2
<span class="linenr">22: </span>  vec1 = vec1+vec2
<span class="linenr">23: </span>  mat1 = mat1-mat2
<span class="linenr">24: </span>  vec1 = vec1-vec2
<span class="linenr">25: </span>  vec1 = mat1*vec2
<span class="linenr">26: </span>  mat1 = mat2*mat1
<span class="linenr">27: </span>  mat1 = <span style="color: #D0372D;">2</span>.<span style="color: #D0372D;">0</span>*mat1
<span class="linenr">28: </span>  vec1 = <span style="color: #D0372D;">2</span>.<span style="color: #D0372D;">0</span>*vec1
<span class="linenr">29: </span>  mat1 = mat1/<span style="color: #D0372D;">2</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">30: </span>  vec1 = vec1/<span style="color: #D0372D;">2</span>.<span style="color: #D0372D;">0</span>
<span class="linenr">31: </span>  mat2 = mat1**<span style="color: #D0372D;">3</span>
<span class="linenr">32: </span>  <span style="color: #8D8D84;">! </span><span style="color: #8D8D84; font-style: italic;">norm</span>
<span class="linenr">33: </span>  x = norm<span style="color: #707183;">(</span>vec1,<span style="color: #D0372D;">0</span><span style="color: #707183;">)</span>
<span class="linenr">34: </span>  x = norm<span style="color: #707183;">(</span>vec1,<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr">35: </span>  x = norm<span style="color: #707183;">(</span>mat1,-<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr">36: </span>  x = norm<span style="color: #707183;">(</span>mat1,<span style="color: #D0372D;">0</span><span style="color: #707183;">)</span>
<span class="linenr">37: </span>  x = norm<span style="color: #707183;">(</span>mat1,<span style="color: #D0372D;">1</span><span style="color: #707183;">)</span>
<span class="linenr">38: </span>  x = norm<span style="color: #707183;">(</span>mat1,<span style="color: #D0372D;">2</span><span style="color: #707183;">)</span>
<span class="linenr">39: </span>  <span style="color: #0000FF;">call</span> <span style="color: #006699;">vec1</span>%destruct
<span class="linenr">40: </span>  <span style="color: #0000FF;">call</span> <span style="color: #006699;">vec2</span>%destruct
<span class="linenr">41: </span>  <span style="color: #0000FF;">call</span> <span style="color: #006699;">mat1</span>%destruct
<span class="linenr">42: </span>  <span style="color: #0000FF;">call</span> <span style="color: #006699;">mat2</span>%destruct
<span class="linenr">43: </span><span style="color: #0000FF;">end program</span> <span style="color: #006699;">main</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">./main
</pre>
</div>

</div>
</div>
</div>
</div>
</div>
</body>
</html>
